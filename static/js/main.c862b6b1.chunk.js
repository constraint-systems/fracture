(this.webpackJsonprefract=this.webpackJsonprefract||[]).push([[0],{21:function(e,t,n){},22:function(e,t,n){},24:function(e,t,n){"use strict";n.r(t);var c=n(0),r=n(3),i=n.n(r),a=n(10),s=n.n(a),o=(n(21),n(22),n(4)),l=n(5),j=n(2),b=n(1),u=500;function v(e,t,n){var c=t[0],r=t[1],i=t[2],a=t[3],s=t[4],o=t[5],l=t[6],j=t[7],b=t[8],u=t[9],v=t[10],d=t[11],f=t[12],O=t[13],h=t[14],p=t[15],k=n[0],m=n[1],x=n[2],w=n[3];return e[0]=k*c+m*s+x*b+w*f,e[1]=k*r+m*o+x*u+w*O,e[2]=k*i+m*l+x*v+w*h,e[3]=k*a+m*j+x*d+w*p,k=n[4],m=n[5],x=n[6],w=n[7],e[4]=k*c+m*s+x*b+w*f,e[5]=k*r+m*o+x*u+w*O,e[6]=k*i+m*l+x*v+w*h,e[7]=k*a+m*j+x*d+w*p,k=n[8],m=n[9],x=n[10],w=n[11],e[8]=k*c+m*s+x*b+w*f,e[9]=k*r+m*o+x*u+w*O,e[10]=k*i+m*l+x*v+w*h,e[11]=k*a+m*j+x*d+w*p,k=n[12],m=n[13],x=n[14],w=n[15],e[12]=k*c+m*s+x*b+w*f,e[13]=k*r+m*o+x*u+w*O,e[14]=k*i+m*l+x*v+w*h,e[15]=k*a+m*j+x*d+w*p,e}function d(e,t,n,c){var r,i,a,s,o,l,j,b,u,v,d=t[0],f=t[1],O=t[2],h=c[0],p=c[1],k=c[2],m=n[0],x=n[1],w=n[2];return Math.abs(d-m)<1e-6&&Math.abs(f-x)<1e-6&&Math.abs(O-w)<1e-6?function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e):(j=d-m,b=f-x,u=O-w,r=p*(u*=v=1/Math.sqrt(j*j+b*b+u*u))-k*(b*=v),i=k*(j*=v)-h*u,a=h*b-p*j,(v=Math.sqrt(r*r+i*i+a*a))?(r*=v=1/v,i*=v,a*=v):(r=0,i=0,a=0),s=b*a-u*i,o=u*r-j*a,l=j*i-b*r,(v=Math.sqrt(s*s+o*o+l*l))?(s*=v=1/v,o*=v,l*=v):(s=0,o=0,l=0),e[0]=r,e[1]=s,e[2]=j,e[3]=0,e[4]=i,e[5]=o,e[6]=b,e[7]=0,e[8]=a,e[9]=l,e[10]=u,e[11]=0,e[12]=-(r*d+i*f+a*O),e[13]=-(s*d+o*f+l*O),e[14]=-(j*d+b*f+u*O),e[15]=1,e)}function f(e,t){var n=t[0],c=t[1],r=t[2],i=t[3],a=t[4],s=t[5],o=t[6],l=t[7],j=t[8],b=t[9],u=t[10],v=t[11],d=t[12],f=t[13],O=t[14],h=t[15],p=n*s-c*a,k=n*o-r*a,m=n*l-i*a,x=c*o-r*s,w=c*l-i*s,g=r*l-i*o,y=j*f-b*d,_=j*O-u*d,E=j*h-v*d,C=b*O-u*f,L=b*h-v*f,R=u*h-v*O,M=p*R-k*L+m*C+x*E-w*_+g*y;return M?(M=1/M,e[0]=(s*R-o*L+l*C)*M,e[1]=(r*L-c*R-i*C)*M,e[2]=(f*g-O*w+h*x)*M,e[3]=(u*w-b*g-v*x)*M,e[4]=(o*E-a*R-l*_)*M,e[5]=(n*R-r*E+i*_)*M,e[6]=(O*m-d*g-h*k)*M,e[7]=(j*g-u*m+v*k)*M,e[8]=(a*L-s*E+l*y)*M,e[9]=(c*E-n*L-i*y)*M,e[10]=(d*w-f*m+h*p)*M,e[11]=(b*m-j*w-v*p)*M,e[12]=(s*_-a*C-o*y)*M,e[13]=(n*C-c*_+r*y)*M,e[14]=(f*k-d*x-O*p)*M,e[15]=(j*x-b*k+u*p)*M,e):null}function O(e,t){var n=e[0],c=e[1],r=e[2],i=e[3],a=e[4],s=e[5],o=e[6],l=e[7],j=e[8],b=e[9],u=e[10],v=e[11],d=e[12],f=e[13],O=e[14],h=e[15],p=t[0],k=t[1],m=t[2],x=t[3];return[p*n+k*a+m*j+x*d,p*c+k*s+m*b+x*f,p*r+k*o+m*u+x*O,p*i+k*l+m*v+x*h]}function h(e){if(e.viewports.length>0){var t=e.viewports[0][2],n=e.viewports[0][3];!function(e,t,n,c,r){var i=1/Math.tan(t/2),a=1/(c-r);e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(r+c)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*r*c*a,e[15]=0}(e.projection,Math.PI/3,t/n,.01,100),f(e.inverse_projection,e.projection)}}function p(e){return[e[0],e[1],0]}function k(e,t,n){var c=function(e,t){var n=O(e.projection,[0,0,t,1]);return n[2]/n[3]}(e,-n),r=[2*t/e.viewports[0][2],0,c,1],i=O(e.inverse_projection,r);return i[0]/i[3]}function m(e,t,n,c){var r=e.viewports[t],i=function(e,t,n){var c=O(e.view_projections[t],[0,0,n,1]);return c[2]/c[3]}(e,t,c),a=function(e,t){return[(t[0]-e[0])/e[2]*2-1,(t[1]-e[1])/e[3]*2-1]}(r,n),s=[a[0],a[1],i,1],o=O(e.inverse_view_projections[t],s);return[o[0]/o[3],o[1]/o[3]]}Object(b.b)({key:"scene",default:{}});var x=Object(b.b)({key:"active",default:[2,1,1,1]}),w=Object(b.b)({key:"mode",default:"normal"}),g=Object(b.d)({key:"sMode",get:function(e){return(0,e.get)(w)},set:function(e,t){(0,e.set)(w,t)}}),y=Object(b.b)({key:"size",default:[null,null]}),_=Object(b.b)({key:"gridSize",default:[null,null]}),E=Object(b.d)({key:"changeGridSize",set:function(e,t){var n=e.get,c=e.set,r=Object(j.a)(t,2),i=r[0],a=r[1],s=n(_).slice(),o=Object(j.a)(s,2),l=o[0],b=o[1],u=Math.max(64,l+8*i),v=Math.max(64,b+8*a);c(_,[u,v])}}),C=Object(b.b)({key:"cols",default:4}),L=Object(b.b)({key:"rows",default:4}),R=Object(b.b)({key:"barHeight",default:0}),M=Object(b.b)({key:"sidebarWidth",default:360}),z=Object(b.b)({key:"cameras",default:[]}),S=Object(b.c)({key:"camera",default:[0,0,5]}),I=Object(b.b)({key:"imageMap",default:[]}),A=Object(b.b)({key:"images",default:[]}),P=Object(b.d)({key:"addImage",set:function(e,t){var n=e.get,c=e.set,r=n(A);c(A,[].concat(Object(l.a)(r),[t]))}});function N(e,t,n){var c=Object(j.a)(e,4),r=c[0],i=c[1],a=c[2],s=c[3];return a>t&&(a=t),s>n&&(s=n),[B(r,0,t-a),B(i,0,n-s),a,s]}function B(e,t,n){return Math.max(t,Math.min(n,e))}var T=Object(b.d)({key:"activeSelector",set:function(e,t){var n=e.get;(0,e.set)(x,N(t,n(C),n(L)))}}),D=Object(b.d)({key:"selectAll",set:function(e,t){var n=e.get;(0,e.set)(x,[0,0,n(C),n(L)])}}),F=Object(b.d)({key:"moveActiveSelector",set:function(e,t){var n=e.get,c=e.set,r=n(x),i=Object(j.a)(r,4),a=i[0],s=i[1],o=i[2],l=i[3],b=Object(j.a)(t,2),u=b[0],v=b[1];c(T,[a+u,s+v,o,l])}});var U=Object(b.d)({key:"resizeActiveSelector",set:function(e,t){var n=e.get,c=e.set,r=n(x),i=Object(j.a)(r,4),a=i[0],s=i[1],o=i[2],l=i[3],b=Object(j.a)(t,2),u=b[0],v=b[1];c(x,function(e,t,n){var c=Object(j.a)(e,4),r=c[0],i=c[1],a=c[2],s=c[3],o=t-e[0],l=n-e[1];return[r,i,B(a,1,o),B(s,1,l)]}([a,s,o+u,l+v],n(C),n(L)))}}),Y=Object(b.d)({key:"viewports",get:function(e){var t=e.get,n=t(_),c=Object(j.a)(n,2),r=c[0],i=c[1],a=t(C),s=t(L),o=Math.floor(r/a),b=Math.floor(i/s);return Object(l.a)(Array(a*s)).map((function(e,t){var n=t%a,c=Math.floor(t/a);return[n*o,c*b,o,b]}))}}),H=Object(b.d)({key:"panCamera",set:function(e,t){for(var n=e.get,c=e.set,r=t.scene,i=t.diff,a=Object(j.a)(i,2),s=a[0],o=a[1],l=n(z),b=n(C),u=n(x),v=Object(j.a)(u,4),d=v[0],f=v[1],O=v[2],h=v[3],p=0;p<h;p++)for(var m=0;m<O;m++){var w=l[(f+p)*b+(d+m)],g=n(S(w)).slice(),y=k(r,s,g[2]),_=k(r,o,g[2]);g[0]-=y,g[1]+=_,c(S(w),g)}}}),X=Object(b.d)({key:"activeEscape",set:function(e){var t=e.get,n=e.set,c=t(x),r=Object(j.a)(c,4),i=r[0],a=r[1];r[2],r[3];n(x,[i,a,1,1])}}),W=Object(b.d)({key:"resetZoom",set:function(e){for(var t=e.get,n=e.set,c=t(z),r=t(C),i=t(x),a=Object(j.a)(i,4),s=a[0],o=a[1],l=a[2],b=a[3],u=0;u<b;u++)for(var v=0;v<l;v++){var d=c[(o+u)*r+(s+v)],f=t(S(d)).slice();f[2]=5,n(S(d),f)}}}),q=Object(b.d)({key:"allCameras",get:function(e){for(var t=e.get,n=t(z),c=t(C),r=t(L),i=[],a=0;a<r;a++)for(var s=0;s<c;s++){var o=n[a*c+s],l=t(S(o));i.push(l)}return i}}),G=Object(b.d)({key:"mosaicCamera",set:function(e,t){for(var n=e.get,c=e.set,r=t.scene,i=t.active,a=n(z),s=n(Y),o=n(_),l=Object(j.a)(o,2),b=l[0],u=l[1],v=n(C),d=n(L),f=void 0===i?n(x):i,O=Object(j.a)(f,4),h=O[0],p=O[1],m=O[2],w=O[3],g=0;g<w;g++)for(var y=0;y<m;y++){var E=(d-1-(p+g))*v+(h+y),R=a[(p+g)*v+(h+y)],M=Object(j.a)(s[E],4),I=M[0],A=M[1],P=M[2],N=M[3],B=n(S(R)).slice(),T=A+N/2-u/2,D=k(r,I+P/2-b/2,B[2]),F=k(r,T,B[2]);B[0]=D,B[1]=F,c(S(R),B)}}}),J=Object(b.d)({key:"shakeCamera",set:function(e,t){for(var n=e.get,c=e.set,r=t.scene,i=t.active,a=n(z),s=n(C),o=void 0===i?n(x):i,l=Object(j.a)(o,4),b=l[0],u=l[1],v=l[2],d=l[3],f=0;f<d;f++)for(var O=0;O<v;O++){var h=a[(u+f)*s+(b+O)],p=n(S(h)).slice(),m=k(r,24,p[2]),w=0-m/2+Math.random()*m,g=0-m/2+Math.random()*m;p[0]+=w,p[1]+=g,c(S(h),p)}}}),Z=Object(b.d)({key:"pushCameras",set:function(e,t){for(var n=e.get,c=e.set,r=t.scene,i=(t.active,n(x)),a=Object(j.a)(i,4),s=a[0],o=a[1],l=a[2],b=a[3],u=n(z),v=n(C),d=s+l/2,f=o+b/2,O=0;O<b;O++)for(var h=0;h<l;h++){var p=u[(o+O)*v+(s+h)],m=n(S(p)),w=m.slice(),g=0,y=0;d<h+s+.5?g=-1:d>h+s+.5&&(g=1),f<O+o+.5?y=1:f>O+o+.5&&(y=-1);var _=k(r,8*g,m[2]),E=k(r,8*y,m[2]);w[0]+=_,w[1]+=E,c(S(p),w)}}}),K=Object(b.d)({key:"pullCameras",set:function(e,t){for(var n=e.get,c=e.set,r=t.scene,i=(t.active,n(x)),a=Object(j.a)(i,4),s=a[0],o=a[1],l=a[2],b=a[3],u=n(z),v=n(C),d=s+l/2,f=o+b/2,O=0;O<b;O++)for(var h=0;h<l;h++){var p=u[(o+O)*v+(s+h)],m=n(S(p)),w=m.slice(),g=0,y=0;d<h+s+.5?g=1:d>h+s+.5&&(g=-1),f<O+o+.5?y=-1:f>O+o+.5&&(y=1);var _=k(r,8*g,m[2]),E=k(r,8*y,m[2]);w[0]+=_,w[1]+=E,c(S(p),w)}}}),V=Object(b.d)({key:"shatterCamera",set:function(e,t){for(var n=e.get,c=e.set,r=n(z),i=n(C),a=(n(L),n(x)),s=Object(j.a)(a,4),o=s[0],l=s[1],b=s[2],u=s[3],v=0;v<u;v++)for(var d=0;d<b;d++){var f=r[(l+v)*i+(o+d)],O=n(S(f)).slice();O[0]=0,O[1]=0,c(S(f),O)}}}),Q=Object(b.d)({key:"setImageMap",set:function(e,t){for(var n=e.get,c=e.set,r=t.active,i=n(C),a=n(L),s=void 0===r?n(x):r,o=Object(j.a)(s,4),l=o[0],b=o[1],u=o[2],v=o[3],d=n(A),f=n(I).slice(),O=0;O<v;O++)for(var h=0;h<u;h++){f[(a-1-(b+O))*i+(l+h)]=d.length-1}c(I,f)}});function $(e){return Math.min(100,Math.max(.01,e))}var ee=Object(b.b)({key:"zoomMode",default:"canvas"}),te=Object(b.b)({key:"showCameras",default:!1}),ne=Object(b.b)({key:"showGrid",default:!0}),ce=Object(b.b)({key:"showPreview",default:!1}),re=Object(b.b)({key:"copy",default:[]}),ie=Object(b.d)({key:"setCopy",set:function(e){for(var t=e.get,n=e.set,c=t(x),r=Object(j.a)(c,4),i=r[0],a=r[1],s=r[2],o=r[3],l=t(I),b=t(C),u=t(L),v=t(z),d=[],f=0;f<o;f++)for(var O=0;O<s;O++){var h=(u-1-(a+f))*b+(i+O),p=v[(a+f)*b+(i+O)],k=t(S(p)),m=l[h],w=[k.slice(),m];d.push(w)}n(re,d)}}),ae=Object(b.d)({key:"setPaste",set:function(e){var t=e.get,n=e.set;if(t(re).length>0){for(var c=t(x),r=Object(j.a)(c,4),i=r[0],a=r[1],s=r[2],o=r[3],l=t(I).slice(),b=t(C),u=t(L),v=t(z),d=t(re),f=0;f<o;f++)for(var O=0;O<s;O++){var h=f*s+O;void 0===d[h]&&(h=d.length-1);var p=Object(j.a)(d[h],2),k=p[0],m=p[1],w=(u-1-(a+f))*b+(i+O),g=v[(a+f)*b+(i+O)];l[w]=m,n(S(g),k)}n(I,l)}}}),se=Object(b.d)({key:"zoomCamera",set:function(e,t){for(var n=e.get,c=e.set,r=t.scene,i=t.sign,a=t.mult,s=n(z),o=n(C),b=n(L),u=n(x),v=Object(j.a)(u,4),d=v[0],f=v[1],O=v[2],h=v[3],p=n(_),k=Object(j.a)(p,2),w=k[0],g=k[1],y=n(ee),E=n(Y),R=Object(j.a)(E[(b-(f+h))*o+d],2),M=R[0],I=R[1],A=Object(j.a)(E[0],4),P=(A[0],A[1],[A[2]*O,A[3]*h]),N=0;N<h;N++)for(var B=0;B<O;B++){var T=(b-1-(f+N))*o+(d+B),D=s[(f+N)*o+(d+B)],F=n(S(D)).slice(),U=F[2],H=$(i>0?U*a:U/a);if(H>U||H<U){if("canvas"===y){var X=m(r,T,[w/2,g/2],H);F=[].concat(Object(l.a)(X),[H])}else if("active"===y){var W=m(r,T,[M+P[0]/2,I+P[1]/2],H);F=[].concat(Object(l.a)(W),[H])}else F[2]=H;c(S(D),F)}}}}),oe=Object(b.d)({key:"addCol",set:function(e){var t=e.get,n=e.set,c=t(C),r=t(L);if(c<10){for(var i=t(x),a=Object(j.a)(i,4),s=a[0],o=a[1],b=a[2],u=a[3],v=s+b,d=v-1,f=t(I),O=Object(l.a)(Array(c)).map((function(e){return[]})),h=0;h<r;h++)for(var p=0;p<c;p++){var k=h*c+p;O[p].push(f[k])}var m=O[d].slice();O.splice(v,0,m);for(var w=[],g=0;g<r;g++)for(var y=0;y<O.length;y++)w.push(O[y][g]);for(var _=t(z),E=Object(l.a)(Array(c)).map((function(e){return[]})),R=0;R<r;R++)for(var M=0;M<c;M++){var A=R*c+M;E[M].push(_[A])}for(var P=E[d].slice(),N=[],B=0;B<r;B++){var T=Me(),D=P[B],F=t(S(D)).slice();n(S(T),F),N.push(T)}E.splice(v,0,N);for(var U=[],Y=0;Y<r;Y++)for(var H=0;H<E.length;H++)U.push(E[H][Y]);n(z,U),n(I,w),n(C,c+1),n(x,[s,o,b+1,u])}}}),le=Object(b.d)({key:"remCol",set:function(e){var t=e.get,n=e.set,c=t(C),r=t(L);if(c>1){for(var i=t(x),a=Object(j.a)(i,4),s=a[0],o=a[1],b=a[2],u=a[3],v=s,d=t(I),f=Object(l.a)(Array(c)).map((function(e){return[]})),O=0;O<r;O++)for(var h=0;h<c;h++){var p=O*c+h;f[h].push(d[p])}f.splice(v,1);for(var k=[],m=0;m<r;m++)for(var w=0;w<f.length;w++)k.push(f[w][m]);for(var g=t(z),y=Object(l.a)(Array(c)).map((function(e){return[]})),_=0;_<r;_++)for(var E=0;E<c;E++){var R=_*c+E;y[E].push(g[R])}y.splice(v,1);for(var M=[],S=0;S<r;S++)for(var A=0;A<y.length;A++)M.push(y[A][S]);n(z,M),n(I,k),n(C,c-1),n(x,N(b>1?[s,o,b-1,u]:[s-1,o,b,u],c-1,r))}}}),je=Object(b.d)({key:"addRow",set:function(e){var t=e.get,n=e.set,c=t(C),r=t(L);if(r<8){for(var i=t(x),a=Object(j.a)(i,4),s=a[0],o=a[1],b=a[2],u=a[3],v=o+u,d=v-1,f=t(I),O=Object(l.a)(Array(r)).map((function(e){return[]})),h=0;h<r;h++)for(var p=0;p<c;p++){var k=h*c+p;O[h].push(f[k])}var m=O[d].slice();O.splice(v,0,m);for(var w=[],g=0;g<O.length;g++)for(var y=0;y<c;y++)w.push(O[g][y]);for(var _=t(z),E=Object(l.a)(Array(r)).map((function(e){return[]})),R=0;R<r;R++)for(var M=0;M<c;M++){var A=R*c+M;E[R].push(_[A])}for(var P=E[d].slice(),N=[],B=0;B<c;B++){var T=Me(),D=P[B],F=t(S(D)).slice();n(S(T),F),N.push(T)}E.splice(v,0,N);for(var U=[],Y=0;Y<E.length;Y++)for(var H=0;H<c;H++)U.push(E[Y][H]);n(z,U),n(I,w),n(L,r+1),n(x,[s,o,b,u+1])}}}),be=Object(b.d)({key:"remRoww",set:function(e){var t=e.get,n=e.set,c=t(C),r=t(L);if(r>1){for(var i=t(x),a=Object(j.a)(i,4),s=a[0],o=a[1],b=a[2],u=a[3],v=o,d=t(I),f=Object(l.a)(Array(r)).map((function(e){return[]})),O=0;O<r;O++)for(var h=0;h<c;h++){var p=O*c+h;f[O].push(d[p])}f.splice(v,1);for(var k=[],m=0;m<f.length;m++)for(var w=0;w<c;w++)k.push(f[m][w]);for(var g=t(z),y=Object(l.a)(Array(r)).map((function(e){return[]})),_=0;_<r;_++)for(var E=0;E<c;E++){var R=_*c+E;y[_].push(g[R])}y.splice(v,1);for(var M=[],S=0;S<y.length;S++)for(var A=0;A<c;A++)M.push(y[S][A]);n(z,M),n(I,k),n(L,r-1),n(x,N(u>1?[s,o,b,u-1]:[s-1,o,b,u],c,r-1))}}}),ue=n(6);var ve=function(e){var t=e.scene_ref,n=e.input_ref,c=Object(b.h)(g),i=Object(j.a)(c,2),a=i[0],s=i[1],o=Object(b.k)(F),l=Object(b.k)(U),u=Object(b.h)(ee),v=Object(j.a)(u,2),d=(v[0],v[1]),f=Object(b.h)(te),O=Object(j.a)(f,2),h=O[0],p=O[1],k=Object(b.h)(ne),m=Object(j.a)(k,2),x=m[0],w=m[1],y=Object(b.h)(ce),_=Object(j.a)(y,2),L=_[0],R=_[1],M=Object(b.k)(se),z=Object(b.k)(H),S=Object(b.k)(G),I=Object(b.k)(V),A=Object(b.k)(J),N=Object(b.k)(Z),B=Object(b.k)(K),T=Object(b.k)(D),Y=Object(b.k)(E),$=Object(b.k)(oe),re=Object(b.k)(le),ve=Object(b.k)(je),de=Object(b.k)(be),fe=Object(b.k)(W),Oe=Object(b.k)(X),he=Object(b.k)(P),pe=Object(b.k)(Q),ke=Object(r.useRef)({}),me=Object(ue.e)(),xe=Object(ue.d)(),we=Object(b.k)(ie),ge=Object(b.k)(ae),ye=(Object(b.f)(),["h","j","k","l","arrowleft","arrowright","arrowup","arrowdown"]),_e=Object(b.f)((function(e){var t=e.snapshot;return function(){var e={};e.cols=t.getLoadable(C).contents,e.rows=t.getLoadable(C).contents,e.cameras=t.getLoadable(q).contents,console.log(JSON.stringify(e))}}));return Object(r.useEffect)((function(){var e=ke.current,c=t.current,r=n.current;function i(t){var n=t.key.toLowerCase();e[n]=!0,function(t,n){if(e[1]&&_e(),!n.ctrlKey)return ye.includes(t)&&n.preventDefault(),e.z&&me(),e.x&&xe(),"normal"===a?(e.h&&o([-1,0]),e.j&&o([0,1]),e.k&&o([0,-1]),e.l&&o([1,0]),e.arrowleft&&z({scene:c,diff:[-8,0]}),e.arrowright&&z({scene:c,diff:[8,0]}),e.arrowup&&z({scene:c,diff:[0,-8]}),e.arrowdown&&z({scene:c,diff:[0,8]}),"r"===t&&s("resize"),"a"===t&&T(),"escape"===t&&Oe(),e["-"]&&M({scene:c,sign:1,mult:1.125}),e["+"]&&M({scene:c,sign:-1,mult:1.125}),e["="]&&M({scene:c,sign:-1,mult:1.125}),e.s&&d("canvas"),e.i&&d("individual"),e.t&&d("active"),"o"===t&&Ue(c,r,he,pe.bind(null,{})),e.c&&we(),e.v&&ge(),e.e&&I({scene:c}),e.m&&S({scene:c}),e.b&&A({scene:c}),e.u&&N({scene:c}),e.n&&B({scene:c}),e.d&&fe(),e.p&&R(!L),e.g&&w(!x),e.f&&p(!h),e.w&&(c.capture=!0),e.z&&me(),e.y&&xe(),e["("]&&re(),e[")"]&&$(),e["["]&&de(),e["]"]&&ve(),void("x"===t&&s("canvasResize"))):"resize"===a?(e.h&&l([-1,0]),e.j&&l([0,1]),e.k&&l([0,-1]),e.l&&l([1,0]),e.arrowleft&&l([-1,0]),e.arrowdown&&l([0,1]),e.arrowup&&l([0,-1]),e.arrowright&&l([1,0]),"escape"===t&&Oe(),"a"===t&&T(),"r"===t&&s("normal"),void(e.enter&&s("normal"))):"canvasResize"===a?(e.h&&Y([-1,0]),e.j&&Y([0,1]),e.k&&Y([0,-1]),e.l&&Y([1,0]),e.arrowleft&&Y([-1,0]),e.arrowdown&&Y([0,1]),e.arrowup&&Y([0,-1]),e.arrowright&&Y([1,0]),"x"===t&&s("normal"),void(e.enter&&s("normal"))):void 0;if(ye.includes(t)){var i;n.preventDefault();var j=[0,0];"h"!==t&&"arrowleft"!==t||(j[0]-=16),"j"!==t&&"arrowdown"!==t||(j[1]+=16),"k"!==t&&"arrowup"!==t||(j[1]-=16),"l"!==t&&"arrowright"!==t||(j[0]+=16),(i=window).scrollBy.apply(i,j)}}(n,t)}function j(t){var n=t.key.toLowerCase();e[n]=!1}return window.addEventListener("keydown",i),window.addEventListener("keyup",j),function(){window.removeEventListener("keydown",i),window.removeEventListener("keyup",j)}}),[a,x,h,L]),null},de=n(15),fe=n.n(de);var Oe=function(e){var t=e.canvas_ref,n=e.scene_ref,c=e.scroll_ref,i=Object(r.useRef)({raw:[0,0],down:!1,drag_start:null,scrollCheck:[0,0]}),a=Object(b.j)(Y),s=Object(b.k)(H),l=Object(b.j)(x),u=Object(b.j)(C),v=Object(b.j)(g),d=Object(b.k)(T),f=Object(b.k)(se),O=Object(b.k)(P),h=Object(b.k)(Q),p=Object(ue.b)();return p.startBatch,p.endBatch,Object(r.useEffect)((function(){function e(e){for(var t=Object(j.a)(e,2),n=t[0],c=t[1],r=0;r<a.length;r++){var i=a[r],s=Object(j.a)(i,4),o=s[0],l=s[1],b=s[2],v=s[3],d=r%u,f=Math.floor(r/u);if(n>=o&&n<=o+b&&c>=l&&c<=l+v)return[d,f]}}var r=t.current,b=i.current,p=n.current;c.current;function k(t){if(t.preventDefault(),t.clientX!==b.raw[0]&&t.clientY!==b.raw[1]){if(b.scroll){var n=t.clientX-b.scrollCheck[0],c=t.clientY-b.scrollCheck[1];return window.scrollBy(-n,-c),b.scrollCheck=[t.clientX,t.clientY],!1}var r=t.target.getBoundingClientRect(),i=t.clientX-r.left,a=t.clientY-r.top;if(b.down)if("resize"===v){var o=Object(j.a)(l,4),u=o[0],f=o[1],O=o[2],h=o[3],k=e(b.raw),m=Object(j.a)(k,2),x=m[0],w=m[1],g=u+O-1,y=f+h-1,_=Math.min(x,u),E=Math.min(w,f),C=Math.max(x,g),L=Math.max(w,y);d([_,E,C-_+1,L-E+1])}else{var R=i-b.raw[0],M=a-b.raw[1];s({scene:p,diff:[R,M]})}b.raw=[i,a]}}function m(t){if(t.preventDefault(),t.ctrlKey)return b.scroll=!0,r.setPointerCapture(t.pointerId),b.scrollCheck=[t.clientX,t.clientY],!1;var n=t.target.getBoundingClientRect(),c=t.clientX-n.left,i=t.clientY-n.top;if(b.raw=[c,i],"resize"===v){var a=Object(j.a)(l,4),s=(a[0],a[1],a[2],a[3],e(b.raw)),o=Object(j.a)(s,2),u=o[0],f=o[1];d([u,f,1,1]),b.down=!0}else if("normal"===v){var O=Object(j.a)(l,4),h=O[0],p=O[1],k=O[2],m=O[3],x=e(b.raw),w=Object(j.a)(x,2),g=w[0],y=w[1];g>=h&&g<h+k&&y>=p&&y<p+m||d([g-Math.round((k-1)/2),y-Math.round((m-1)/2),k,m]),b.down=!0}r.setPointerCapture(t.pointerId)}function x(e){e.preventDefault(),b.down=!1,b.scroll=!1,r.releasePointerCapture(e.pointerId)}function w(e){if(e.preventDefault(),"normal"===v){var t=e.deltaY<0?-1:1,n=Math.abs(e.deltaY);f({scene:p,sign:t,mult:n>25?1.125:1+n/80*.125})}}function g(e){e.preventDefault(),e.stopPropagation();var t=e.dataTransfer.files[0],n=(t.path?t.path:t.name&&t.name,URL.createObjectURL(t));Fe(p,n,O)}function y(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function _(e){e.preventDefault(),e.stopPropagation(),console.log("paste");var t,n=Object(o.a)(e.clipboardData.items);try{for(n.s();!(t=n.n()).done;){var c=t.value;if(!(c.type.indexOf("image")<0)){var r=c.getAsFile(),i=URL.createObjectURL(r);Fe(p,i,O,h.bind(null,{}))}}}catch(a){n.e(a)}finally{n.f()}}return r.addEventListener("pointermove",k),r.addEventListener("pointerdown",m),r.addEventListener("pointerup",x),r.addEventListener("wheel",w,{passive:!1}),window.addEventListener("paste",_),window.addEventListener("dragover",y),window.addEventListener("drop",g),function(){r.removeEventListener("pointermove",k),r.removeEventListener("pointerdown",m),r.removeEventListener("pointerup",x),r.removeEventListener("wheel",w),window.removeEventListener("paste",_),window.removeEventListener("dragover",y),window.removeEventListener("drop",g)}}),[a,v,t,l,u]),null};var he=function(e){var t=e.scene_ref.current,n=Object(b.k)(P),r=Object(b.k)(se),i=Object(b.k)(Q),a=Object(b.k)(V),s=Object(b.k)(G),o=(Object(b.k)(J),Object(b.k)(W)),l=Object(b.k)(T),j=Object(b.k)(oe),u=Object(b.k)(le),v=Object(b.k)(je),d=Object(b.k)(be),f=Object(b.k)(ie),O=Object(b.k)(ae);return Object(c.jsxs)("div",{children:[Object(c.jsx)(ge,{text:"Animals",click:function(){var e=4-t.cols,c=4-t.rows;if(e>0)for(var r=0;r<e;r++)j();if(e<0)for(var a=0;a<Math.abs(e);a++)u();if(c>0)for(var b=0;b<c;b++)v();if(c<0)for(var f=0;f<Math.abs(c);f++)d();Fe(t,"/images/dog.jpg",n,i.bind(null,{active:[0,0,2,2]}),(function(){l([0,0,2,2]),o(),s({scene:t})})),Fe(t,"/images/panda.jpg",n,i.bind(null,{active:[2,0,2,4]}),(function(){l([2,0,2,4]),o(),s({scene:t})})),Fe(t,"/images/frog.jpg",n,i.bind(null,{active:[0,2,2,2]}),(function(){l([0,2,2,2]),o(),s({scene:t})}))}}),Object(c.jsx)(ge,{text:"Wright",click:function(){var e=4-t.cols,c=4-t.rows;if(e>0)for(var b=0;b<e;b++)j();if(e<0)for(var f=0;f<Math.abs(e);f++)u();if(c>0)for(var O=0;O<c;O++)v();if(c<0)for(var h=0;h<Math.abs(c);h++)d();Fe(t,"/images/flw.jpg",n,i.bind(null,{active:[0,0,4,4]}),(function(){l([0,0,4,4]),o(),r({scene:t,sign:1,mult:1.5}),l([0,0,2,4]),s({scene:t}),l([2,0,2,4]),a({scene:t})}))}}),Object(c.jsx)(ge,{text:"Rocks",click:function(){var e=5-t.cols,c=3-t.rows;if(e>0)for(var s=0;s<e;s++)j();if(e<0)for(var b=0;b<Math.abs(e);b++)u();if(c>0)for(var h=0;h<c;h++)v();if(c<0)for(var p=0;p<Math.abs(c);p++)d();Fe(t,"/images/iron.jpg",n,i.bind(null,{active:[4,0,1,1]}),(function(){l([4,0,1,1]),o(),r({scene:t,sign:1,mult:2}),a({scene:t}),f(),l([0,0,1,1]),O(),l([2,0,1,1]),O(),l([1,1,1,1]),O(),l([3,1,1,1]),O(),l([2,2,1,1]),O(),l([0,2,1,1]),O(),l([2,2,1,1]),O(),l([4,2,1,1]),O()})),Fe(t,"/images/smithsonite.jpg",n,i.bind(null,{active:[4,1,1,1]}),(function(){l([4,1,1,1]),o(),r({scene:t,sign:1,mult:2}),a({scene:t}),f(),l([1,0,1,1]),O(),l([3,0,1,1]),O(),l([0,1,1,1]),O(),l([2,1,1,1]),O(),l([1,2,1,1]),O(),l([3,2,1,1]),O()}))}})]})};function pe(e){return Object(c.jsx)("div",{className:"heading",style:{marginBottom:8},children:e.children.toUpperCase()})}function ke(e){return Object(c.jsx)("div",{style:{marginBottom:8},children:e.children})}function me(e){return Object(c.jsx)("div",{style:{marginBottom:8,color:"#aaa"},children:e.children})}function xe(){return Object(c.jsx)("div",{style:{width:"100%",height:4}})}var we=function(e){var t=e.scene_ref,n=e.input_ref,i=e.mobile,a=(e.bypass_ref,Object(b.j)(M)),s=Object(b.h)(g),o=Object(j.a)(s,2),l=o[0],u=o[1],v=Object(b.h)(ee),d=Object(j.a)(v,2),f=d[0],O=d[1],h=Object(b.h)(te),p=Object(j.a)(h,2),k=p[0],m=p[1],x=Object(b.h)(ne),w=Object(j.a)(x,2),y=w[0],_=w[1],C=Object(b.h)(ce),L=Object(j.a)(C,2),R=L[0],z=L[1],S=Object(b.k)(F),I=Object(b.k)(U),A=Object(b.k)(se),N=Object(b.k)(H),B=Object(b.k)(G),T=Object(b.k)(V),Y=Object(b.k)(J),q=Object(b.k)(Z),$=Object(b.k)(K),re=Object(b.k)(D),ve=Object(b.k)(ie),de=Object(b.k)(ae),fe=Object(b.k)(oe),Oe=Object(b.k)(le),we=Object(b.k)(je),Ce=Object(b.k)(be),Le=Object(b.k)(W),Re=Object(b.k)(X),Me=Object(b.k)(P),ze=Object(b.k)(Q),Se=Object(b.k)(E),Ie=(Object(r.useRef)({}),Object(ue.e)()),Ae=Object(ue.d)(),Pe=Object(r.useRef)(null),Ne="resize"===l,Be=t.current,Te=n.current,De={position:"fixed",right:0,height:"100%",top:0,width:a,overflow:"auto",background:"#222",userSelect:"none"};return Object(r.useEffect)((function(){null!==Pe.current&&Pe.current.scrollTo(0,0)}),[l,Pe]),Object(c.jsx)("div",{ref:Pe,style:i?{position:"fixed",left:0,bottom:0,height:288,overflow:"auto",background:"#222",userSelect:"none"}:De,children:Object(c.jsx)("div",{style:{padding:16,userSelect:"none"},children:Ne?Object(c.jsxs)("div",{children:[Object(c.jsx)(pe,{children:"Resize selection mode"}),Object(c.jsx)("div",{children:Object(c.jsx)(Ee,{text:"Resize selection",keyname:"r",compare:Ne,click:u.bind(null,"normal")})}),Object(c.jsx)(ke,{children:"Click and drag cells or use"}),Object(c.jsx)("div",{children:Object(c.jsx)(_e,{text:"narrower",keyname1:"\u2190",keyname2:"h",click:I.bind(null,[-1,0])})}),Object(c.jsx)("div",{children:Object(c.jsx)(_e,{text:"wider",keyname1:"\u2192",keyname2:"l",click:I.bind(null,[-1,0])})}),Object(c.jsx)("div",{children:Object(c.jsx)(_e,{text:"shorter",keyname1:"\u2191",keyname2:"k",click:I.bind(null,[0,-1])})}),Object(c.jsx)("div",{children:Object(c.jsx)(_e,{text:"taller",keyname1:"\u2193",keyname2:"j",click:I.bind(null,[0,1])})}),Object(c.jsx)(ke,{children:"Finish"}),Object(c.jsx)("div",{children:Object(c.jsx)(ge,{text:"End resize",keyname:"enter",click:u.bind(null,"normal")})}),Object(c.jsxs)(me,{children:[Object(c.jsx)("div",{children:"TIP:"}),"When resizing with the keyboard controls, the top left corner of the selection is locked to its position."]})]}):"canvasResize"===l?Object(c.jsxs)("div",{children:[Object(c.jsx)(pe,{children:"Resize Canvas"}),Object(c.jsx)(Ee,{text:"Resize canvas",keyname:"x",compare:"canvasResize"===l,click:u.bind(null,"normal")}),Object(c.jsx)("div",{children:Object(c.jsx)(_e,{text:"narrower",keyname1:"\u2190",keyname2:"h",click:Se.bind(null,[-1,0])})}),Object(c.jsx)("div",{children:Object(c.jsx)(_e,{text:"wider",keyname1:"\u2192",keyname2:"l",click:Se.bind(null,[1,0])})}),Object(c.jsx)("div",{children:Object(c.jsx)(_e,{text:"shorter",keyname1:"\u2191",keyname2:"k",click:Se.bind(null,[0,-1])})}),Object(c.jsx)("div",{children:Object(c.jsx)(_e,{text:"taller",keyname1:"\u2193",keyname2:"j",click:Se.bind(null,[0,1])})}),Object(c.jsx)(ke,{children:"Finish"}),Object(c.jsx)("div",{children:Object(c.jsx)(ge,{text:"End resize",keyname:"enter",click:u.bind(null,"normal")})}),Object(c.jsx)(xe,{}),Object(c.jsx)(ke,{children:"Need to scroll the canvas? Hold Ctrl and click and drag, or use:"}),Object(c.jsxs)("div",{children:[Object(c.jsx)(_e,{text:"",keyname1:"Ctrl+\u2190",keyname2:"Ctrl+h",click:window.scrollBy.bind(null,-16,0)}),Object(c.jsx)(_e,{text:"",keyname1:"Ctrl+\u2192",keyname2:"Ctrl+l",click:window.scrollBy.bind(null,16,0)}),Object(c.jsx)(_e,{text:"",keyname1:"Ctrl+\u2191",keyname2:"Ctrl+k",click:window.scrollBy.bind(null,0,-16)}),Object(c.jsx)(_e,{text:"",keyname1:"Ctrl+\u2193",keyname2:"Ctrl+j",click:window.scrollBy.bind(null,0,16)})]})]}):Object(c.jsxs)("div",{children:[Object(c.jsx)(ke,{children:"Shatter and recombine images using a grid of viewports"}),Object(c.jsx)(xe,{}),Object(c.jsx)(pe,{children:"Examples"}),Object(c.jsx)(he,{scene_ref:t}),Object(c.jsx)(xe,{}),Object(c.jsx)(pe,{children:"Select"}),Object(c.jsxs)("div",{children:[Object(c.jsx)(ke,{children:"Click a cell or move with"}),Object(c.jsx)(ge,{text:"\u2190",keyname:"h",click:S.bind(null,[-1,0])}),Object(c.jsx)(ge,{text:"\u2193",keyname:"j",click:S.bind(null,[0,1])}),Object(c.jsx)(ge,{text:"\u2191",keyname:"k",click:S.bind(null,[0,-1])}),Object(c.jsx)(ge,{text:"\u2192",keyname:"l",click:S.bind(null,[1,0])})]}),Object(c.jsx)(ke,{children:"Change selection size"}),Object(c.jsxs)("div",{children:[Object(c.jsx)(Ee,{text:"Resize selection",keyname:"r",compare:Ne,click:u.bind(null,"resize")}),Object(c.jsxs)("div",{children:[Object(c.jsx)(ge,{text:"Select all",keyname:"a",click:re}),Object(c.jsx)(ge,{text:"Clear",keyname:"escape",click:Re})]})]}),Object(c.jsx)(xe,{}),Object(c.jsx)(pe,{children:"Pan"}),Object(c.jsx)(ke,{children:"Click and drag or use"}),Object(c.jsxs)("div",{children:[Object(c.jsx)(ge,{text:"",keyname:"\u2190",click:N.bind(null,{scene:Be,diff:[1,0]})}),Object(c.jsx)(ge,{text:"",keyname:"\u2193",click:N.bind(null,{scene:Be,diff:[0,1]})}),Object(c.jsx)(ge,{text:"",keyname:"\u2191",click:N.bind(null,{scene:Be,diff:[0,-1]})}),Object(c.jsx)(ge,{text:"",keyname:"\u2192",click:N.bind(null,{scene:Be,diff:[-1,0]})})]}),Object(c.jsx)(xe,{}),Object(c.jsx)(pe,{children:"Zoom"}),Object(c.jsx)(ke,{children:"Scroll or use"}),Object(c.jsxs)("div",{children:[Object(c.jsx)(ge,{text:"In",keyname:"+",click:A.bind(null,{scene:Be,sign:-1,mult:1.125})}),Object(c.jsx)(ge,{text:"Out",keyname:"-",click:A.bind(null,{scene:Be,sign:1,mult:1.125})})]}),Object(c.jsx)(ke,{children:"Zoom center"}),Object(c.jsxs)("div",{children:[Object(c.jsx)(Ee,{text:"Canvas",keyname:"s",compare:"canvas"===f,click:O.bind(null,"canvas")}),Object(c.jsx)(Ee,{text:"Individual",keyname:"i",compare:"individual"===f,click:O.bind(null,"individual")}),Object(c.jsx)(Ee,{text:"Active",keyname:"t",compare:"active"===f,click:O.bind(null,"active")})]}),Object(c.jsx)(xe,{}),Object(c.jsx)(pe,{children:"Load image to selection"}),Object(c.jsx)(ye,{text:"Load image",keyname:"o",click:Ue.bind(null,Be,Te,Me,ze.bind(null,{}))}),Object(c.jsxs)(ke,{children:["Or copy and paste an image",Object(c.jsx)("br",{}),"Or drag and drop an image file"]}),Object(c.jsx)(xe,{}),Object(c.jsx)(pe,{children:"Copy/Paste"}),Object(c.jsx)(xe,{}),Object(c.jsx)(ge,{text:"Copy",keyname:"c",click:ve}),Object(c.jsx)(ge,{text:"Paste",keyname:"v",click:de}),Object(c.jsx)(pe,{children:"More actions"}),Object(c.jsx)(ge,{text:"Shatter",keyname:"e",click:T.bind(null,{scene:Be})}),Object(c.jsx)(ge,{text:"Mosaic",keyname:"m",click:B.bind(null,{scene:Be})}),Object(c.jsx)(ge,{text:"Shake",keyname:"b",click:Y.bind(null,{scene:Be})}),Object(c.jsx)(ge,{text:"Push",keyname:"u",click:q.bind(null,{scene:Be})}),Object(c.jsx)(ge,{text:"Pull",keyname:"n",click:$.bind(null,{scene:Be})}),Object(c.jsx)(ge,{text:"Reset zoom",keyname:"d",click:Le.bind(null,Be)}),Object(c.jsx)(xe,{}),Object(c.jsx)(pe,{children:"View"}),Object(c.jsx)(Ee,{text:"Preview",keyname:"p",compare:R,click:z.bind(null,!R)}),Object(c.jsx)(Ee,{text:"Show grid",keyname:"g",compare:y,disabled:!!R,click:_.bind(null,!y)}),Object(c.jsx)(Ee,{text:"Show camera info",keyname:"f",disabled:!!R,compare:k,click:m.bind(null,!k)}),Object(c.jsx)(xe,{}),Object(c.jsx)(pe,{children:"Save Image"}),Object(c.jsx)(xe,{}),Object(c.jsx)(ge,{text:"Save image",keyname:"w",click:function(){Be.capture=!0}}),Object(c.jsx)(pe,{children:"Undo/Redo"}),Object(c.jsx)(xe,{}),Object(c.jsx)(ge,{text:"Undo",keyname:"z",click:Ie}),Object(c.jsx)(ge,{text:"Redo",keyname:"y",click:Ae}),Object(c.jsx)(pe,{children:"Change Grid"}),Object(c.jsx)(xe,{}),Object(c.jsxs)("div",{children:["Cols: ",Object(c.jsx)(ge,{text:"Remove",keyname:"(",click:Oe}),Object(c.jsx)(ge,{text:"Add",keyname:")",click:fe})]}),Object(c.jsxs)("div",{children:["Rows: ",Object(c.jsx)(ge,{text:"Remove",keyname:"[",click:Ce}),Object(c.jsx)(ge,{text:"Add",keyname:"]",click:we})]}),Object(c.jsx)(pe,{children:"Resize Canvas"}),Object(c.jsx)(Ee,{text:"Resize canvas",keyname:"x",compare:"canvasResize"===l,click:u.bind(null,"canvasResize")}),Object(c.jsx)(xe,{}),Object(c.jsx)(me,{children:"Need to scroll the canvas? Hold Ctrl and click and drag."})]})})})};function ge(e){var t=Object(r.useRef)(null),n=e.text,i=e.click,a=e.keyname;return window.intervalCheck=null,Object(r.useEffect)((function(){var e,n=t.current;function c(){window.intervalCheck=setInterval(i,60)}function r(t){clearInterval(window.intervalCheck),e=setTimeout(c,250),i(),n.setPointerCapture(t.pointerId)}function a(t){clearTimeout(e),clearInterval(window.intervalCheck),n.releasePointerCapture(t.pointerId)}return n.addEventListener("pointerdown",r),n.addEventListener("pointerup",a),function(){n.removeEventListener("pointerdown",r),n.removeEventListener("pointerup",a)}}),[]),Object(c.jsxs)("div",{ref:t,className:"button",role:"button",children:[""!==n?n+" ":"",a?Object(c.jsx)("span",{className:"keyname",children:a}):""]})}function ye(e){var t=Object(r.useRef)(null),n=e.text,i=e.click,a=e.keyname;return Object(c.jsxs)("div",{ref:t,className:"button",role:"button",onClick:i,children:[""!==n?n+" ":"",Object(c.jsx)("span",{className:"keyname",children:a})]})}function _e(e){var t=Object(r.useRef)(null),n=e.text,i=e.click,a=e.keyname1,s=e.keyname2;return Object(r.useEffect)((function(){var e,n,c=t.current;function r(){n=setInterval(i,60)}function a(t){c.setPointerCapture(t.pointerId),e=setTimeout(r,250),i()}function s(t){c.releasePointerCapture(t.pointerId),clearTimeout(e),clearInterval(n)}return c.addEventListener("pointerdown",a),c.addEventListener("pointerup",s),function(){c.removeEventListener("pointerdown",a),c.removeEventListener("pointerup",s)}}),[]),Object(c.jsxs)("div",{ref:t,className:"button",role:"button",children:[""!==n?n+" ":"",Object(c.jsx)("span",{className:"keyname",children:a})," ",Object(c.jsx)("span",{className:"keytip",children:"or"})," ",Object(c.jsx)("span",{className:"keyname",children:s})]})}function Ee(e){var t=Object(r.useRef)(null),n=e.text,i=e.click,a=e.keyname,s=e.compare,o=e.disabled;return Object(c.jsxs)("div",{ref:t,className:"button toggle ".concat(s?"active":""," ").concat(o?"disabled":""),role:"button",onClick:i,children:[""!==n?n+" ":"",a?Object(c.jsx)("span",{className:"keyname",children:a}):null]})}function Ce(e,t,n,c){return[[e,t],[n,t],[e,c],[e,c],[n,t],[n,c]]}function Le(e,t,n,c,r,i){var a=e.regl;return a({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    uniform sampler2D texture;\n    varying vec2 vuv;\n    void main () {\n      gl_FragColor = texture2D(texture, vuv);\n    }",vert:"\n    precision mediump float;\n    attribute vec2 position;\n    attribute vec2 uv;\n    varying vec2 vuv;\n    uniform mat4 view_projection;\n    void main () {\n      vuv = uv;\n      gl_Position = view_projection * vec4(position, 0, 1);\n    }",attributes:{position:Ce(n,c,r,i),uv:[[0,0],[1,0],[0,1],[0,1],[1,0],[1,1]]},uniforms:{texture:a.texture(t),color:[1,1,0,1],view_projection:a.prop("view_projection")},count:6})}var Re=0;function Me(){return++Re}var ze=function(){var e=Object(r.useRef)({viewports:[],projection:[],inverse_projection:[],views:[],view_projections:[],inverse_view_projections:[],image_map:[],image_draws:[],capture:!1}),t=Object(r.useRef)(null),n=Object(r.useRef)(null),i=Object(r.useRef)(!1);return Object(c.jsx)(b.a,{children:Object(c.jsxs)(ue.a,{trackingByDefault:!1,children:[Object(c.jsx)("input",{style:{display:"none"},type:"file",accept:"image/*",ref:t}),Object(c.jsx)(Ae,{}),Object(c.jsxs)("div",{style:{position:"relative",marginLeft:4,marginTop:4},children:[Object(c.jsx)(Ye,{scroll_ref:n,scene_ref:e,bypass_ref:i}),Object(c.jsx)(Ie,{})]}),Object(c.jsx)(Se,{scene_ref:e,input_ref:t,bypass_ref:i}),Object(c.jsx)(ve,{scene_ref:e,input_ref:t,bypass_ref:i})]})})};function Se(e){var t=e.input_ref,n=e.scene_ref,r=e.bypass_ref,i=Object(b.j)(y),a=Object(j.a)(i,2),s=a[0];a[1];return s<u?Object(c.jsx)(we,{mobile:!0,scene_ref:n,input_ref:t,bypass_ref:r}):Object(c.jsx)(we,{scene_ref:n,input_ref:t,bypass_ref:r})}function Ie(){var e=Object(b.j)(ce),t=Object(b.j)(te),n=Object(b.j)(ne),r=Object(b.j)(g);return Object(c.jsxs)(i.a.Fragment,{children:[e?null:t?Object(c.jsx)(Be,{}):null,e?null:n?Object(c.jsx)(Te,{}):null,e||"canvasResize"===r?null:Object(c.jsx)(Ne,{}),"canvasResize"===r?Object(c.jsx)(Pe,{}):null]})}function Ae(){var e=Object(b.k)(y),t=Object(b.k)(_),n=Object(b.j)(R),c=Object(b.j)(M);return Object(r.useEffect)((function(){function r(){var r=window.innerWidth,i=window.innerHeight;e([r,i]),t(r<u?[r-8,i-288-8]:[r-c-8,i-n-12])}return r(),window.addEventListener("resize",r),function(){window.removeEventListener("resize",r)}}),[e,t]),null}function Pe(){var e=Object(b.j)(C),t=Object(b.j)(L),n=Object(b.j)(Y)[0];return Object(c.jsx)("div",{className:"active-outline resize-canvas",style:{position:"absolute",left:0,top:0,width:e*n[2],height:t*n[3],pointerEvents:"none",touchEvents:"none"}})}function Ne(){var e=Object(b.j)(x),t=Object(b.j)(Y),n=Object(b.j)(g),i=t[0];return Object(c.jsx)("div",{className:"active-outline",style:{position:"absolute",left:e[0]*i[2],top:e[1]*i[3],width:e[2]*i[2],height:e[3]*i[3],pointerEvents:"none",touchEvents:"none"},children:"resize"===n?Object(c.jsxs)(r.Fragment,{children:[Object(c.jsx)("div",{style:{position:"absolute",left:0,top:0,background:"#111",width:17,height:17,borderBottom:"solid 1px white",borderRight:"solid 1px white"}}),Object(c.jsx)("div",{style:{position:"absolute",right:0,bottom:0,background:"#111",width:17,height:17,borderTop:"solid 1px white",borderLeft:"solid 1px white"}})]}):null})}function Be(){var e=Object(b.j)(Y),t=Object(b.j)(z);return e.map((function(n,r){var i=e[r],a=t[r];return Object(c.jsx)("div",{style:{position:"absolute",left:i[0],top:i[1],width:i[2],height:i[3],pointerEvents:"none",touchEvents:"none"},children:Object(c.jsx)(De,{id:a})},"camera".concat(r))}))}function Te(){var e=Object(b.j)(_),t=Object(j.a)(e,2),n=t[0],r=t[1],a=Object(b.j)(C),s=Object(b.j)(L),o=(Object(b.j)(ce),Math.floor(n/a)),u=Math.floor(r/s),v=o*a,d=u*s,f=160;return Object(c.jsxs)("div",{children:[a>0?Object(l.a)(Array(a-1)).map((function(e,t){return Object(c.jsxs)(i.a.Fragment,{children:[Object(c.jsx)("div",{style:{pointerEvents:"none",touchEvents:"none",position:"absolute",left:(t+1)*o-1.5,top:0,width:3,height:d,background:"rgba(20,20,20,0.5)"}}),Object(c.jsx)("div",{style:{pointerEvents:"none",touchEvents:"none",position:"absolute",left:(t+1)*o-.5,top:0,width:1,height:d,background:"rgba("+[f,f,f]+",0.5)"}})]},"colback_".concat(t))})):null,s>0?Object(l.a)(Array(s-1)).map((function(e,t){return Object(c.jsxs)(i.a.Fragment,{children:[Object(c.jsx)("div",{style:{pointerEvents:"none",touchEvents:"none",position:"absolute",left:0,top:(t+1)*u-1.5,height:3,width:v,background:"rgba(20,20,20,0.5)"}}),Object(c.jsx)("div",{style:{pointerEvents:"none",touchEvents:"none",position:"absolute",left:0,top:(t+1)*u-.5,height:1,width:v,background:"rgba("+[f,f,f]+",0.5)"}})]},"rowback_".concat(t))})):null]})}function De(e){var t=e.id,n=Object(b.j)(S(t));return Object(c.jsx)("div",{className:"outline-text",style:{position:"absolute",fontSize:12,left:0,bottom:8,paddingLeft:8,paddingRight:8,color:"#eee",userSelect:"none",width:"100%",overflow:"hidden"},children:n.map((function(e){return Math.round(100*(e+Number.EPSILON))/100})).join(",")})}function Fe(e,t,n,c,r){var i=new Image;i.onload=function(){e.pixel=k(e,1,5);var t=i.width*e.pixel,a=i.height*e.pixel,s=[-t/2,a/2,t/2,-a/2];n(i);var o=Le.apply(void 0,[e,i].concat(s));e.image_draws.push(o),void 0!==c&&c(),void 0!==r&&r()},i.src=t}function Ue(e,t,n,c){t.addEventListener("change",(function r(i){var a,s=Object(o.a)(this.files);try{for(s.s();!(a=s.n()).done;){var l=a.value;if(!(l.type.indexOf("image")<0)){var j=URL.createObjectURL(l);Fe(e,j,n,c),t.value=null}}}catch(b){s.e(b)}finally{s.f()}t.removeEventListener("change",r)})),t.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}function Ye(e){var t=e.scene_ref,n=e.scroll_ref,i=(e.bypass_ref,Object(b.j)(_)),a=Object(b.j)(Y),s=Object(b.j)(C),o=Object(b.j)(L),v=Object(b.j)(M),d=Object(b.j)(q),f=(Object(b.j)(A),Object(b.j)(R)),O=Object(b.k)(P),h=Object(b.h)(I),p=Object(j.a)(h,2),k=p[0],m=p[1],x=Object(b.k)(Q),w=Object(b.k)(G),g=Object(b.h)(z),E=Object(j.a)(g,2),S=E[0],N=E[1],B=Object(r.useRef)(null),T=Object(r.useRef)(null),D=Object(b.j)(y),F=Object(r.useState)(!1),U=Object(j.a)(F,2),H=U[0],X=U[1],W=Object(ue.c)(),J=(W.getIsTrackingHistory,W.setIsTrackingHistory);return Object(r.useEffect)((function(){if(null!==i[0]&&!H){var e=fe()(B.current);T.current=e;var n=t.current;n.regl=e;for(var c=[],r=0;r<s*o;r++){var b=Me();c.push(b),n.views.push([]),n.view_projections.push([]),n.inverse_view_projections.push([]),n.image_map.push(null)}N(c),n.cameras=Object(l.a)(Array(s*o)).map((function(e){return[0,0,5]})),m(Object(l.a)(Array(s*o)).map((function(e){return null}))),He(n,s,o,i,a,d),Fe(n,"/images/ozymandias-screens-watchmen.jpg",O,x.bind(null,{active:[0,0,s,o]}),(function(){w({scene:n,active:[0,0,s,o]}),J(!0)}));var u=B.current.getContext("webgl");u.enable(u.SCISSOR_TEST),e.frame((function(t){t.tick;if(e.clear({color:[0,0,0,1]}),n.viewports.length>0)for(var c=n.gridSize[1]-n.viewports[0][3]*n.rows,r=0;r<n.viewports.length;r++){var i=n.viewports[r],a=Object(j.a)(i,4),s=a[0],o=a[1],l=a[2],b=a[3];if(o+=c,u.viewport(s,o,l,b),u.scissor(s,o,l,b),e.clear({color:[0,0,0,1]}),n.image_map.length>0&&null!==n.image_map[r])(0,n.image_draws[n.image_map[r]])({view_projection:n.view_projections[r]})}if(n.capture){n.capture=!1;var v=document.createElement("canvas");v.width=n.viewports[0][2]*n.cols,v.height=n.viewports[0][3]*n.rows,v.getContext("2d").drawImage(u.canvas,0,0);var d=document.createElement("a");v.toBlob((function(e){d.setAttribute("download","fracture-"+Math.round((new Date).getTime()/1e3)+".png"),d.setAttribute("href",URL.createObjectURL(e)),d.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}))}})),X(!0)}}),[i,H]),Object(r.useEffect)((function(){H&&(t.current.image_map=k)}),[H,k]),Object(r.useEffect)((function(){H&&He(t.current,s,o,i,a,d)}),[H,s,o,i,a,S]),null!==i[0]?Object(c.jsx)("div",{ref:n,style:{width:i[0]+(D[0]>u?v:0)+4,height:i[1]+(D[0]>u?f+8:4),userSelect:"none",touchAction:"none"},children:Object(c.jsxs)("canvas",{width:i[0],height:i[1],ref:B,children:[S.map((function(e,n){return Object(c.jsx)(Xe,{id:e,index:n,scene_ref:t},e)})),Object(c.jsx)(Oe,{canvas_ref:B,scene_ref:t,scroll_ref:n})]})}):null}function He(e,t,n,c,r,i){for(var a=i.slice(),s=[],o=0;o<n;o++)for(var l=0;l<t;l++){var j=o*t+l,b=(n-1-Math.floor(j/t))*t+j%t;s.push(a[b])}e.cameras=s,e.gridSize=c,e.cols=t,e.rows=n,e.viewports=r,h(e),e.views=[],e.view_projections=[],e.inverse_view_projections=[];for(var u=0;u<t*n;u++)e.views.push([]),e.view_projections.push([]),e.inverse_view_projections.push([]);!function(e){for(var t=0;t<e.cameras.length;t++){var n=e.cameras[t];d(e.views[t],n,p(n),[0,1,0]),v(e.view_projections[t],e.projection,e.views[t]),f(e.inverse_view_projections[t],e.view_projections[t])}}(e)}function Xe(e){var t=e.id,n=e.index,c=e.scene_ref,i=Object(b.j)(S(t));return Object(r.useEffect)((function(){var e=c.current,t=(e.rows-1-Math.floor(n/e.cols))*e.cols+n%e.cols;e.cameras[t]=i,function(e,t){var n=e.cameras[t];e.views[t]&&(d(e.views[t],n,p(n),[0,1,0]),v(e.view_projections[t],e.projection,e.views[t]),f(e.inverse_view_projections[t],e.view_projections[t]))}(e,t)}),[t,n,i,c]),null}var We=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,25)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,i=t.getLCP,a=t.getTTFB;n(e),c(e),r(e),i(e),a(e)}))};s.a.render(Object(c.jsx)(i.a.StrictMode,{children:Object(c.jsx)(ze,{})}),document.getElementById("root")),We()}},[[24,1,2]]]);
//# sourceMappingURL=main.c862b6b1.chunk.js.map