(this.webpackJsonprefract=this.webpackJsonprefract||[]).push([[0],{21:function(e,t,n){},23:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n(3),i=n.n(c),a=n(10),o=n.n(a),s=(n(21),n(5)),j=n(2),l=n(4),u=n(0),b=1.125;function v(e,t,n){var r=t[0],c=t[1],i=t[2],a=t[3],o=t[4],s=t[5],j=t[6],l=t[7],u=t[8],b=t[9],v=t[10],d=t[11],f=t[12],O=t[13],p=t[14],h=t[15],m=n[0],x=n[1],k=n[2],g=n[3];return e[0]=m*r+x*o+k*u+g*f,e[1]=m*c+x*s+k*b+g*O,e[2]=m*i+x*j+k*v+g*p,e[3]=m*a+x*l+k*d+g*h,m=n[4],x=n[5],k=n[6],g=n[7],e[4]=m*r+x*o+k*u+g*f,e[5]=m*c+x*s+k*b+g*O,e[6]=m*i+x*j+k*v+g*p,e[7]=m*a+x*l+k*d+g*h,m=n[8],x=n[9],k=n[10],g=n[11],e[8]=m*r+x*o+k*u+g*f,e[9]=m*c+x*s+k*b+g*O,e[10]=m*i+x*j+k*v+g*p,e[11]=m*a+x*l+k*d+g*h,m=n[12],x=n[13],k=n[14],g=n[15],e[12]=m*r+x*o+k*u+g*f,e[13]=m*c+x*s+k*b+g*O,e[14]=m*i+x*j+k*v+g*p,e[15]=m*a+x*l+k*d+g*h,e}function d(e,t,n,r){var c,i,a,o,s,j,l,u,b,v,d=t[0],f=t[1],O=t[2],p=r[0],h=r[1],m=r[2],x=n[0],k=n[1],g=n[2];return Math.abs(d-x)<1e-6&&Math.abs(f-k)<1e-6&&Math.abs(O-g)<1e-6?function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e):(l=d-x,u=f-k,b=O-g,c=h*(b*=v=1/Math.sqrt(l*l+u*u+b*b))-m*(u*=v),i=m*(l*=v)-p*b,a=p*u-h*l,(v=Math.sqrt(c*c+i*i+a*a))?(c*=v=1/v,i*=v,a*=v):(c=0,i=0,a=0),o=u*a-b*i,s=b*c-l*a,j=l*i-u*c,(v=Math.sqrt(o*o+s*s+j*j))?(o*=v=1/v,s*=v,j*=v):(o=0,s=0,j=0),e[0]=c,e[1]=o,e[2]=l,e[3]=0,e[4]=i,e[5]=s,e[6]=u,e[7]=0,e[8]=a,e[9]=j,e[10]=b,e[11]=0,e[12]=-(c*d+i*f+a*O),e[13]=-(o*d+s*f+j*O),e[14]=-(l*d+u*f+b*O),e[15]=1,e)}function f(e,t){var n=t[0],r=t[1],c=t[2],i=t[3],a=t[4],o=t[5],s=t[6],j=t[7],l=t[8],u=t[9],b=t[10],v=t[11],d=t[12],f=t[13],O=t[14],p=t[15],h=n*o-r*a,m=n*s-c*a,x=n*j-i*a,k=r*s-c*o,g=r*j-i*o,y=c*j-i*s,w=l*f-u*d,_=l*O-b*d,E=l*p-v*d,L=u*O-b*f,C=u*p-v*f,M=b*p-v*O,z=h*M-m*C+x*L+k*E-g*_+y*w;return z?(z=1/z,e[0]=(o*M-s*C+j*L)*z,e[1]=(c*C-r*M-i*L)*z,e[2]=(f*y-O*g+p*k)*z,e[3]=(b*g-u*y-v*k)*z,e[4]=(s*E-a*M-j*_)*z,e[5]=(n*M-c*E+i*_)*z,e[6]=(O*x-d*y-p*m)*z,e[7]=(l*y-b*x+v*m)*z,e[8]=(a*C-o*E+j*w)*z,e[9]=(r*E-n*C-i*w)*z,e[10]=(d*g-f*x+p*h)*z,e[11]=(u*x-l*g-v*h)*z,e[12]=(o*_-a*L-s*w)*z,e[13]=(n*L-r*_+c*w)*z,e[14]=(f*m-d*k-O*h)*z,e[15]=(l*k-u*m+b*h)*z,e):null}function O(e,t){var n=e[0],r=e[1],c=e[2],i=e[3],a=e[4],o=e[5],s=e[6],j=e[7],l=e[8],u=e[9],b=e[10],v=e[11],d=e[12],f=e[13],O=e[14],p=e[15],h=t[0],m=t[1],x=t[2],k=t[3];return[h*n+m*a+x*l+k*d,h*r+m*o+x*u+k*f,h*c+m*s+x*b+k*O,h*i+m*j+x*v+k*p]}function p(e){if(e.viewports.length>0){var t=e.viewports[0][2],n=e.viewports[0][3];!function(e,t,n,r,c){var i=1/Math.tan(t/2),a=1/(r-c);e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(c+r)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*c*r*a,e[15]=0}(e.projection,Math.PI/3,t/n,.01,100),f(e.inverse_projection,e.projection)}}function h(e){return[e[0],e[1],0]}function m(e,t,n){var r=function(e,t){var n=O(e.projection,[0,0,t,1]);return n[2]/n[3]}(e,-n),c=[2*t/e.viewports[0][2],0,r,1],i=O(e.inverse_projection,c);return i[0]/i[3]}function x(e,t,n,r){var c=e.viewports[t],i=function(e,t,n){var r=O(e.view_projections[t],[0,0,n,1]);return r[2]/r[3]}(e,t,r),a=function(e,t){return[(t[0]-e[0])/e[2]*2-1,(t[1]-e[1])/e[3]*2-1]}(c,n),o=[a[0],a[1],i,1],s=O(e.inverse_view_projections[t],o);return[s[0]/s[3],s[1]/s[3]]}Object(u.b)({key:"scene",default:{}});var k=Object(u.b)({key:"active",default:[0,0,1,1]}),g=Object(u.b)({key:"mode",default:"normal"}),y=Object(u.b)({key:"size",default:[null,null]}),w=Object(u.b)({key:"gridSize",default:[null,null]}),_=Object(u.b)({key:"cols",default:4}),E=Object(u.b)({key:"rows",default:2}),L=Object(u.b)({key:"barHeight",default:32}),C=Object(u.b)({key:"sidebarWidth",default:320}),M=Object(u.b)({key:"cameras",default:[]}),z=Object(u.c)({key:"camera",default:[0,0,5]}),I=Object(u.b)({key:"imageMap",default:[]}),R=Object(u.b)({key:"images",default:[]}),S=Object(u.d)({key:"addImage",set:function(e,t){var n=e.get,r=e.set,c=n(R);r(R,[].concat(Object(s.a)(c),[t]))}});function N(e,t,n){var r=Object(j.a)(e,4),c=r[0],i=r[1],a=r[2],o=r[3];return a>t&&(a=t),o>n&&(o=n),[P(c,0,t-a),P(i,0,n-o),a,o]}function P(e,t,n){return Math.max(t,Math.min(n,e))}var A=Object(u.d)({key:"activeSelector",set:function(e,t){var n=e.get;(0,e.set)(k,N(t,n(_),n(E)))}}),T=Object(u.d)({key:"selectAll",set:function(e,t){var n=e.get;(0,e.set)(k,[0,0,n(_),n(E)])}}),B=Object(u.d)({key:"moveActiveSelector",set:function(e,t){var n=e.get,r=e.set,c=n(k),i=Object(j.a)(c,4),a=i[0],o=i[1],s=i[2],l=i[3],u=Object(j.a)(t,2),b=u[0],v=u[1];r(A,[a+b,o+v,s,l])}});var F=Object(u.d)({key:"resizeActiveSelector",set:function(e,t){var n=e.get,r=e.set,c=n(k),i=Object(j.a)(c,4),a=i[0],o=i[1],s=i[2],l=i[3],u=Object(j.a)(t,2),b=u[0],v=u[1];r(k,function(e,t,n){var r=Object(j.a)(e,4),c=r[0],i=r[1],a=r[2],o=r[3],s=t-e[0],l=n-e[1];return[c,i,P(a,1,s),P(o,1,l)]}([a,o,s+b,l+v],n(_),n(E)))}}),D=Object(u.d)({key:"viewports",get:function(e){var t=e.get,n=t(w),r=Object(j.a)(n,2),c=r[0],i=r[1],a=t(_),o=t(E),l=Math.floor(c/a),u=Math.floor(i/o);return Object(s.a)(Array(a*o)).map((function(e,t){var n=t%a,r=Math.floor(t/a);return[n*l,r*u,l,u]}))}}),H=Object(u.d)({key:"panCamera",set:function(e,t){for(var n=e.get,r=e.set,c=t.scene,i=t.diff,a=Object(j.a)(i,2),o=a[0],s=a[1],l=n(M),u=n(_),b=n(k),v=Object(j.a)(b,4),d=v[0],f=v[1],O=v[2],p=v[3],h=0;h<p;h++)for(var x=0;x<O;x++){var g=l[(f+h)*u+(d+x)],y=n(z(g)).slice(),w=m(c,o,y[2]),E=m(c,s,y[2]);y[0]-=w,y[1]+=E,r(z(g),y)}}}),Y=Object(u.d)({key:"activeEscape",set:function(e){var t=e.get,n=e.set,r=t(k),c=Object(j.a)(r,4),i=c[0],a=c[1];c[2],c[3];n(k,[i,a,1,1])}}),q=Object(u.d)({key:"resetZoom",set:function(e){var t=e.get,n=e.set;console.log("reset zoom");for(var r=t(M),c=t(_),i=t(k),a=Object(j.a)(i,4),o=a[0],s=a[1],l=a[2],u=a[3],b=0;b<u;b++)for(var v=0;v<l;v++){var d=r[(s+b)*c+(o+v)],f=t(z(d)).slice();f[2]=5,n(z(d),f)}}}),U=Object(u.d)({key:"allCameras",get:function(e){for(var t=e.get,n=t(M),r=t(_),c=t(E),i=[],a=0;a<c;a++)for(var o=0;o<r;o++){var s=n[a*r+o],j=t(z(s));i.push(j)}return i}}),W=Object(u.d)({key:"mosaicCamera",set:function(e,t){for(var n=e.get,r=e.set,c=t.scene,i=t.active,a=n(M),o=n(D),s=n(w),l=Object(j.a)(s,2),u=l[0],b=l[1],v=n(_),d=n(E),f=void 0===i?n(k):i,O=Object(j.a)(f,4),p=O[0],h=O[1],x=O[2],g=O[3],y=0;y<g;y++)for(var L=0;L<x;L++){var C=(d-1-(h+y))*v+(p+L),I=a[(h+y)*v+(p+L)],R=Object(j.a)(o[C],4),S=R[0],N=R[1],P=R[2],A=R[3],T=n(z(I)).slice(),B=N+A/2-b/2,F=m(c,S+P/2-u/2,T[2]),H=m(c,B,T[2]);T[0]=F,T[1]=H,r(z(I),T)}}}),X=Object(u.d)({key:"shakeCamera",set:function(e,t){for(var n=e.get,r=e.set,c=t.scene,i=t.active,a=n(M),o=n(_),s=void 0===i?n(k):i,l=Object(j.a)(s,4),u=l[0],b=l[1],v=l[2],d=l[3],f=0;f<d;f++)for(var O=0;O<v;O++){var p=a[(b+f)*o+(u+O)],h=n(z(p)).slice(),x=m(c,24,h[2]),g=0-x/2+Math.random()*x,y=0-x/2+Math.random()*x;h[0]+=g,h[1]+=y,r(z(p),h)}}}),Z=Object(u.d)({key:"pushCameras",set:function(e,t){for(var n=e.get,r=e.set,c=t.scene,i=(t.active,n(k)),a=Object(j.a)(i,4),o=a[0],s=a[1],l=a[2],u=a[3],b=n(M),v=n(_),d=o+l/2,f=s+u/2,O=0;O<u;O++)for(var p=0;p<l;p++){var h=b[(s+O)*v+(o+p)],x=n(z(h)),g=x.slice(),y=0,w=0;d<p+o+.5?y=-1:d>p+o+.5&&(y=1),f<O+s+.5?w=1:f>O+s+.5&&(w=-1);var E=m(c,8*y,x[2]),L=m(c,8*w,x[2]);g[0]+=E,g[1]+=L,r(z(h),g)}}}),J=Object(u.d)({key:"pullCameras",set:function(e,t){for(var n=e.get,r=e.set,c=t.scene,i=(t.active,n(k)),a=Object(j.a)(i,4),o=a[0],s=a[1],l=a[2],u=a[3],b=n(M),v=n(_),d=o+l/2,f=s+u/2,O=0;O<u;O++)for(var p=0;p<l;p++){var h=b[(s+O)*v+(o+p)],x=n(z(h)),g=x.slice(),y=0,w=0;d<p+o+.5?y=1:d>p+o+.5&&(y=-1),f<O+s+.5?w=-1:f>O+s+.5&&(w=1);var E=m(c,8*y,x[2]),L=m(c,8*w,x[2]);g[0]+=E,g[1]+=L,r(z(h),g)}}}),V=Object(u.d)({key:"shatterCamera",set:function(e,t){for(var n=e.get,r=e.set,c=n(M),i=n(_),a=(n(E),n(k)),o=Object(j.a)(a,4),s=o[0],l=o[1],u=o[2],b=o[3],v=0;v<b;v++)for(var d=0;d<u;d++){var f=c[(l+v)*i+(s+d)],O=n(z(f)).slice();O[0]=0,O[1]=0,r(z(f),O)}}}),G=Object(u.d)({key:"setImageMap",set:function(e,t){for(var n=e.get,r=e.set,c=t.active,i=n(_),a=n(E),o=void 0===c?n(k):c,s=Object(j.a)(o,4),l=s[0],u=s[1],b=s[2],v=s[3],d=n(R),f=n(I).slice(),O=0;O<v;O++)for(var p=0;p<b;p++){f[(a-1-(u+O))*i+(l+p)]=d.length-1}r(I,f)}});function K(e){return Math.min(100,Math.max(.01,e))}var Q=Object(u.b)({key:"zoomMode",default:"canvas"}),$=Object(u.d)({key:"zoomCamera",set:function(e,t){for(var n=e.get,r=e.set,c=t.scene,i=t.sign,a=n(M),o=n(_),l=n(E),u=n(k),v=Object(j.a)(u,4),d=v[0],f=v[1],O=v[2],p=v[3],h=n(w),m=Object(j.a)(h,2),g=m[0],y=m[1],L=n(Q),C=0;C<p;C++)for(var I=0;I<O;I++){var R=(l-1-(f+C))*o+(d+I),S=a[(f+C)*o+(d+I)],N=n(z(S)).slice(),P=N[2],A=K(1===i?P*b:P/b);if(A>P||A<P){if("canvas"===L){var T=x(c,R,[g/2,y/2],A);N=[].concat(Object(s.a)(T),[A])}else N[2]=A;r(z(S),N)}}}}),ee=Object(u.d)({key:"addCol",set:function(e){var t=e.get,n=e.set,r=t(_),c=t(E);if(r<16){for(var i=t(k),a=Object(j.a)(i,4),o=a[0],l=(a[1],a[2]),u=(a[3],o+l),b=u-1,v=t(I),d=Object(s.a)(Array(r)).map((function(e){return[]})),f=0;f<c;f++)for(var O=0;O<r;O++){var p=f*r+O;d[O].push(v[p])}var h=d[b].slice();d.splice(u,0,h);for(var m=[],x=0;x<c;x++)for(var g=0;g<d.length;g++)m.push(d[g][x]);for(var y=t(M),w=Object(s.a)(Array(r)).map((function(e){return[]})),L=0;L<c;L++)for(var C=0;C<r;C++){var R=L*r+C;w[C].push(y[R])}for(var S=w[b].slice(),N=[],P=0;P<c;P++){var A=ke(),T=S[P],B=t(z(T)).slice();n(z(A),B),N.push(A)}w.splice(u,0,N);for(var F=[],D=0;D<c;D++)for(var H=0;H<w.length;H++)F.push(w[H][D]);n(M,F),n(I,m),n(_,r+1)}}}),te=Object(u.d)({key:"remCol",set:function(e){var t=e.get,n=e.set,r=t(_),c=t(E);if(r>1){for(var i=t(k),a=Object(j.a)(i,4),o=a[0],l=a[1],u=a[2],b=a[3],v=o,d=t(I),f=Object(s.a)(Array(r)).map((function(e){return[]})),O=0;O<c;O++)for(var p=0;p<r;p++){var h=O*r+p;f[p].push(d[h])}f.splice(v,1);for(var m=[],x=0;x<c;x++)for(var g=0;g<f.length;g++)m.push(f[g][x]);for(var y=t(M),w=Object(s.a)(Array(r)).map((function(e){return[]})),L=0;L<c;L++)for(var C=0;C<r;C++){var z=L*r+C;w[C].push(y[z])}w.splice(v,1);for(var R=[],S=0;S<c;S++)for(var P=0;P<w.length;P++)R.push(w[P][S]);n(M,R),n(I,m),n(_,r-1),n(k,N([o-1,l,u,b],r-1,c))}}}),ne=Object(u.d)({key:"addRow",set:function(e){var t=e.get,n=e.set,r=t(_),c=t(E);if(c<16){for(var i=t(k),a=Object(j.a)(i,4),o=(a[0],a[1]),l=(a[2],o+a[3]),u=l-1,b=t(I),v=Object(s.a)(Array(c)).map((function(e){return[]})),d=0;d<c;d++)for(var f=0;f<r;f++){var O=d*r+f;v[d].push(b[O])}var p=v[u].slice();v.splice(l,0,p);for(var h=[],m=0;m<v.length;m++)for(var x=0;x<r;x++)h.push(v[m][x]);for(var g=t(M),y=Object(s.a)(Array(c)).map((function(e){return[]})),w=0;w<c;w++)for(var L=0;L<r;L++){var C=w*r+L;y[w].push(g[C])}for(var R=y[u].slice(),S=[],N=0;N<r;N++){var P=ke(),A=R[N],T=t(z(A)).slice();n(z(P),T),S.push(P)}y.splice(l,0,S);for(var B=[],F=0;F<y.length;F++)for(var D=0;D<r;D++)B.push(y[F][D]);n(M,B),n(I,h),n(E,c+1)}}}),re=Object(u.d)({key:"remRoww",set:function(e){var t=e.get,n=e.set,r=t(_),c=t(E);if(c>1){for(var i=t(k),a=Object(j.a)(i,4),o=a[0],l=a[1],u=a[2],b=a[3],v=l,d=t(I),f=Object(s.a)(Array(c)).map((function(e){return[]})),O=0;O<c;O++)for(var p=0;p<r;p++){var h=O*r+p;f[O].push(d[h])}f.splice(v,1);for(var m=[],x=0;x<f.length;x++)for(var g=0;g<r;g++)m.push(f[x][g]);for(var y=t(M),w=Object(s.a)(Array(c)).map((function(e){return[]})),L=0;L<c;L++)for(var C=0;C<r;C++){var z=L*r+C;w[L].push(y[z])}w.splice(v,1);for(var R=[],S=0;S<w.length;S++)for(var P=0;P<r;P++)R.push(w[S][P]);n(M,R),n(I,m),n(E,c-1),n(k,N([o-1,l,u,b],r,c-1))}}}),ce=n(6);var ie=function(e){var t=e.scene_ref,n=e.input_ref,r=Object(u.g)(g),i=Object(j.a)(r,2),a=i[0],o=i[1],s=Object(u.j)(B),l=Object(u.j)(F),b=Object(u.j)($),v=Object(u.j)(H),d=Object(u.j)(W),f=Object(u.j)(V),O=Object(u.j)(X),p=Object(u.j)(Z),h=Object(u.j)(J),m=Object(u.j)(T),x=Object(u.j)(ee),k=Object(u.j)(te),y=Object(u.j)(ne),w=Object(u.j)(re),_=Object(u.j)(q),E=Object(u.j)(Y),L=Object(u.j)(S),C=Object(u.j)(G),M=Object(c.useRef)({}),z=Object(ce.e)(),I=Object(ce.d)();return Object(c.useEffect)((function(){var e=M.current,r=t.current,c=n.current;function i(t){var n=t.key.toLowerCase();e[n]=!0,function(t,n){e.z&&z(),e.x&&I(),"normal"===a?(e.h&&s([-1,0]),e.j&&s([0,1]),e.k&&s([0,-1]),e.l&&s([1,0]),e.arrowleft&&v({scene:r,diff:[-8,0]}),e.arrowright&&v({scene:r,diff:[8,0]}),e.arrowup&&v({scene:r,diff:[0,-8]}),e.arrowdown&&v({scene:r,diff:[0,8]}),e["-"]&&b({scene:r,sign:1}),e["+"]&&b({scene:r,sign:-1}),e["="]&&b({scene:r,sign:-1}),e.s&&O({scene:r}),e.u&&p({scene:r}),e.y&&h({scene:r}),e.i&&_(),e.d&&k(),e.f&&x(),e.v&&w(),e.b&&y(),"o"===t&&Ce(r,c,L,C.bind(null,{})),"escape"===t&&E(),"r"===t&&o("resize"),"a"===t&&m(),"m"===t&&d({scene:r}),"n"===t&&f(r)):"resize"===a&&(e.h&&l([-1,0]),e.j&&l([0,1]),e.k&&l([0,-1]),e.l&&l([1,0]),"escape"===t&&E(),"a"===t&&m(),"r"===t&&o("normal"),e.enter&&o("normal"))}(n)}function j(t){var n=t.key.toLowerCase();e[n]=!1}return window.addEventListener("keydown",i),window.addEventListener("keyup",j),function(){window.removeEventListener("keydown",i),window.removeEventListener("keyup",j)}}),[a]),null},ae=n(15),oe=n.n(ae);var se=function(e){var t=e.canvas_ref,n=e.scene_ref,r=Object(c.useRef)({raw:[0,0],down:!1,drag_start:null}),i=Object(c.useRef)(!1),a=Object(u.i)(D),o=Object(u.j)(H),s=Object(u.i)(k),l=Object(u.i)(_),b=Object(u.j)(A),v=Object(u.j)($),d=Object(ce.b)();return d.startBatch,d.endBatch,Object(c.useEffect)((function(){var e=t.current,c=r.current,u=n.current;function d(e){if(c.down){var t=e.clientX-c.raw[0],n=e.clientY-c.raw[1];o({scene:u,diff:[t,n]})}c.raw=[e.clientX,e.clientY]}function f(t){c.raw=[t.clientX,t.clientY];var n=Object(j.a)(s,4),r=n[0],o=n[1],u=n[2],v=n[3],d=function(e){for(var t=Object(j.a)(e,2),n=t[0],r=t[1],c=0;c<a.length;c++){var i=a[c],o=Object(j.a)(i,4),s=o[0],u=o[1],b=o[2],v=o[3],d=c%l,f=Math.floor(c/l);if(n>=s&&n<=s+b&&r>=u&&r<=u+v)return[d,f]}}(c.raw),f=Object(j.a)(d,2),O=f[0],p=f[1];O>=r&&O<r+u&&p>=o&&p<o+v?(i.current=!0,c.down=!0):(b([O-Math.floor((u-1)/2),p-Math.floor((v-1)/2),u,v]),i.current=!0,c.down=!0),e.setPointerCapture(t.pointerId)}function O(t){c.down=!1,e.releasePointerCapture(t.pointerId)}function p(e){e.preventDefault();var t=e.deltaY<0?-1:1;v({scene:u,sign:t})}return e.addEventListener("mousemove",d),e.addEventListener("pointerdown",f),e.addEventListener("pointerup",O),e.addEventListener("wheel",p,{passive:!1}),function(){e.removeEventListener("mousemove",d),e.removeEventListener("pointerdown",f),e.removeEventListener("pointerup",O),e.removeEventListener("wheel",p)}}),[a,t,s,l]),null};function je(e){return Object(r.jsx)("div",{className:"heading",style:{marginBottom:8},children:e.children.toUpperCase()})}function le(e){return Object(r.jsx)("div",{style:{marginBottom:8},children:e.children})}function ue(e){return Object(r.jsx)("div",{style:{marginBottom:8,color:"#aaa"},children:e.children})}function be(){return Object(r.jsx)("div",{style:{width:"100%",height:4}})}var ve=function(e){var t=e.scene_ref,n=e.input_ref,i=Object(u.i)(C),a=Object(u.g)(g),o=Object(j.a)(a,2),s=o[0],l=o[1],b=Object(u.g)(Q),v=Object(j.a)(b,2),d=v[0],f=v[1],O=Object(u.j)(B),p=Object(u.j)(F),h=Object(u.j)($),m=Object(u.j)(H),x=Object(u.j)(W),k=Object(u.j)(V),y=Object(u.j)(X),w=Object(u.j)(Z),_=Object(u.j)(J),E=Object(u.j)(T),L=(Object(u.j)(ee),Object(u.j)(te),Object(u.j)(ne),Object(u.j)(re),Object(u.j)(q)),M=Object(u.j)(Y),z=Object(u.j)(S),I=Object(u.j)(G),R=(Object(c.useRef)({}),Object(ce.e)(),Object(ce.d)(),"resize"===s),N=t.current,P=n.current;return Object(r.jsx)("div",{style:{position:"fixed",right:0,height:"100%",top:0,width:i,overflow:"auto"},children:Object(r.jsx)("div",{style:{padding:16},children:R?Object(r.jsxs)("div",{children:[Object(r.jsx)(je,{children:"Resize selection mode"}),Object(r.jsx)("div",{children:Object(r.jsx)(pe,{text:"Resize selection",keyname:"r",compare:R,click:l.bind(null,"normal")})}),Object(r.jsx)(le,{children:"Click and drag cells or use"}),Object(r.jsx)("div",{children:Object(r.jsx)(Oe,{text:"narrower",keyname1:"\u2190",keyname2:"h",click:p.bind(null,[-1,0])})}),Object(r.jsx)("div",{children:Object(r.jsx)(Oe,{text:"wider",keyname1:"\u2192",keyname2:"l",click:p.bind(null,[-1,0])})}),Object(r.jsx)("div",{children:Object(r.jsx)(Oe,{text:"shorter",keyname1:"\u2191",keyname2:"k",click:p.bind(null,[0,-1])})}),Object(r.jsx)("div",{children:Object(r.jsx)(Oe,{text:"taller",keyname1:"\u2193",keyname2:"j",click:p.bind(null,[0,1])})}),Object(r.jsx)(le,{children:"Finish"}),Object(r.jsx)("div",{children:Object(r.jsx)(de,{text:"End resize",keyname:"enter",click:l.bind(null,"normal")})}),Object(r.jsxs)(ue,{children:[Object(r.jsx)("div",{children:"TIP:"}),"When resizing with the keyboard controls, the top left corner of the selection is locked to its position."]})]}):Object(r.jsxs)("div",{children:[Object(r.jsx)(je,{children:"Select"}),Object(r.jsxs)("div",{children:[Object(r.jsx)(le,{children:"Click a cell or move with"}),Object(r.jsx)(de,{text:"\u2190",keyname:"h",click:O.bind(null,[-1,0])}),Object(r.jsx)(de,{text:"\u2193",keyname:"j",click:O.bind(null,[0,1])}),Object(r.jsx)(de,{text:"\u2191",keyname:"k",click:O.bind(null,[0,-1])}),Object(r.jsx)(de,{text:"\u2192",keyname:"l",click:O.bind(null,[1,0])})]}),Object(r.jsx)(le,{children:"Change selection size"}),Object(r.jsxs)("div",{children:[Object(r.jsx)(pe,{text:"Resize selection",keyname:"r",compare:R,click:l.bind(null,"resize")}),Object(r.jsxs)("div",{children:[Object(r.jsx)(de,{text:"Select all",keyname:"a",click:E}),Object(r.jsx)(de,{text:"Clear",keyname:"escape",click:M})]})]}),Object(r.jsx)(be,{}),Object(r.jsx)(je,{children:"Pan"}),Object(r.jsx)(le,{children:"Click and drag or use"}),Object(r.jsxs)("div",{children:[Object(r.jsx)(de,{text:"",keyname:"\u2190",click:m.bind(null,{scene:N,diff:[1,0]})}),Object(r.jsx)(de,{text:"",keyname:"\u2193",click:m.bind(null,{scene:N,diff:[0,1]})}),Object(r.jsx)(de,{text:"",keyname:"\u2191",click:m.bind(null,{scene:N,diff:[0,-1]})}),Object(r.jsx)(de,{text:"",keyname:"\u2192",click:m.bind(null,{scene:N,diff:[-1,0]})})]}),Object(r.jsx)(be,{}),Object(r.jsx)(je,{children:"Zoom"}),Object(r.jsx)(le,{children:"Scroll or use"}),Object(r.jsxs)("div",{children:[Object(r.jsx)(de,{text:"In",keyname:"+",click:h.bind(null,{scene:N,sign:-1})}),Object(r.jsx)(de,{text:"Out",keyname:"-",click:h.bind(null,{scene:N,sign:1})})]}),Object(r.jsx)(le,{children:"Zoom center"}),Object(r.jsxs)("div",{children:[Object(r.jsx)(pe,{text:"Canvas",keyname:"z",compare:"canvas"===d,click:f.bind(null,"canvas")}),Object(r.jsx)(pe,{text:"Individual",keyname:"i",compare:"individual"===d,click:f.bind(null,"individual")})]}),Object(r.jsx)(be,{}),Object(r.jsx)(je,{children:"Load image to selection"}),Object(r.jsx)(fe,{text:"Load image",keyname:"o",click:Ce.bind(null,N,P,z,I.bind(null,{}))}),Object(r.jsx)(be,{}),Object(r.jsx)(je,{children:"More actions"}),Object(r.jsx)(de,{text:"Shatter",keyname:"y",click:k.bind(null,{scene:N})}),Object(r.jsx)(de,{text:"Mosaic",keyname:"u",click:x.bind(null,{scene:N})}),Object(r.jsx)(de,{text:"Shake",keyname:"t",click:y.bind(null,{scene:N})}),Object(r.jsx)(de,{text:"Push",keyname:"n",click:w.bind(null,{scene:N})}),Object(r.jsx)(de,{text:"Pull",keyname:"m",click:_.bind(null,{scene:N})}),Object(r.jsx)(de,{text:"Reset zoom",keyname:"i",click:L.bind(null,N)}),Object(r.jsx)(be,{}),Object(r.jsx)(je,{children:"View"}),Object(r.jsx)(pe,{text:"Show grid",keyname:"r",compare:R,click:l.bind(null,"resize")}),Object(r.jsx)(pe,{text:"Show camera positions",keyname:"r",compare:R,click:l.bind(null,"resize")})]})})})};function de(e){var t=Object(c.useRef)(null),n=e.text,i=e.click,a=e.keyname;return Object(c.useEffect)((function(){var e,n,r=t.current;function c(){n=setInterval(i,60)}function a(t){r.setPointerCapture(t.pointerId),e=setTimeout(c,250),i()}function o(t){r.releasePointerCapture(t.pointerId),clearTimeout(e),clearInterval(n)}return r.addEventListener("pointerdown",a),r.addEventListener("pointerup",o),function(){r.removeEventListener("pointerdown",a),r.removeEventListener("pointerup",o)}}),[]),Object(r.jsxs)("div",{ref:t,className:"button",role:"button",children:[""!==n?n+" ":"",Object(r.jsx)("span",{className:"keyname",children:a})]})}function fe(e){var t=Object(c.useRef)(null),n=e.text,i=e.click,a=e.keyname;return Object(r.jsxs)("div",{ref:t,className:"button",role:"button",onClick:i,children:[""!==n?n+" ":"",Object(r.jsx)("span",{className:"keyname",children:a})]})}function Oe(e){var t=Object(c.useRef)(null),n=e.text,i=e.click,a=e.keyname1,o=e.keyname2;return Object(c.useEffect)((function(){var e,n,r=t.current;function c(){n=setInterval(i,60)}function a(t){r.setPointerCapture(t.pointerId),e=setTimeout(c,250),i()}function o(t){r.releasePointerCapture(t.pointerId),clearTimeout(e),clearInterval(n)}return r.addEventListener("pointerdown",a),r.addEventListener("pointerup",o),function(){r.removeEventListener("pointerdown",a),r.removeEventListener("pointerup",o)}}),[]),Object(r.jsxs)("div",{ref:t,className:"button",role:"button",children:[""!==n?n+" ":"",Object(r.jsx)("span",{className:"keyname",children:a})," ",Object(r.jsx)("span",{className:"keytip",children:"or"})," ",Object(r.jsx)("span",{className:"keyname",children:o})]})}function pe(e){var t=Object(c.useRef)(null),n=e.text,i=e.click,a=e.keyname,o=e.compare;return Object(r.jsxs)("div",{ref:t,className:"button toggle ".concat(o?"active":""),role:"button",onClick:i,children:[""!==n?n+" ":"",Object(r.jsx)("span",{className:"keyname",children:a})]})}function he(e,t,n,r){return[[e,t],[n,t],[e,r],[e,r],[n,t],[n,r]]}function me(e,t,n,r,c,i){var a=e.regl;return a({frag:"\n    precision mediump float;\n    uniform vec4 color;\n    uniform sampler2D texture;\n    varying vec2 vuv;\n    void main () {\n      gl_FragColor = texture2D(texture, vuv);\n    }",vert:"\n    precision mediump float;\n    attribute vec2 position;\n    attribute vec2 uv;\n    varying vec2 vuv;\n    uniform mat4 view_projection;\n    void main () {\n      vuv = uv;\n      gl_Position = view_projection * vec4(position, 0, 1);\n    }",attributes:{position:he(n,r,c,i),uv:[[0,0],[1,0],[0,1],[0,1],[1,0],[1,1]]},uniforms:{texture:a.texture(t),color:[1,1,0,1],view_projection:a.prop("view_projection")},count:6})}var xe=0;function ke(){return++xe}var ge=function(){var e=Object(c.useRef)({viewports:[],projection:[],inverse_projection:[],views:[],view_projections:[],inverse_view_projections:[],image_map:[],image_draws:[]}),t=Object(c.useRef)(null);return Object(r.jsx)(u.a,{children:Object(r.jsxs)(ce.a,{trackingByDefault:!1,children:[Object(r.jsx)("input",{style:{display:"none"},type:"file",accept:"image/*",ref:t}),Object(r.jsx)(ye,{}),Object(r.jsxs)("div",{style:{position:"relative",marginLeft:4,marginTop:4},children:[Object(r.jsx)(Me,{scene_ref:e}),Object(r.jsx)(we,{}),Object(r.jsx)(_e,{}),Object(r.jsx)(Ie,{})]}),Object(r.jsx)(ve,{scene_ref:e,input_ref:t}),Object(r.jsx)(ie,{scene_ref:e,input_ref:t})]})})};function ye(){var e=Object(u.j)(y),t=Object(u.j)(w),n=Object(u.i)(L),r=Object(u.i)(C);return Object(c.useEffect)((function(){var c=window.innerWidth,i=window.innerHeight;e([c-r-4,i-n-4]),t([c-r-4,i-n-4])}),[e,t]),null}function we(){var e=Object(u.i)(k),t=Object(u.i)(D),n=Object(u.i)(g),i=t[0];return Object(r.jsx)("div",{className:"active-outline",style:{position:"absolute",left:e[0]*i[2],top:e[1]*i[3],width:e[2]*i[2],height:e[3]*i[3],pointerEvents:"none"},children:"resize"===n?Object(r.jsxs)(c.Fragment,{children:[Object(r.jsx)("div",{style:{position:"absolute",left:0,top:0,background:"#111",width:17,height:17,borderBottom:"solid 1px white",borderRight:"solid 1px white"}}),Object(r.jsx)("div",{style:{position:"absolute",right:0,bottom:0,background:"#111",width:17,height:17,borderTop:"solid 1px white",borderLeft:"solid 1px white"}})]}):null})}function _e(){var e=Object(u.i)(D),t=Object(u.i)(M);return e.map((function(n,c){var i=e[c],a=t[c];return Object(r.jsx)("div",{style:{position:"absolute",left:i[0],top:i[1],width:i[2],height:i[3],pointerEvents:"none"},children:Object(r.jsx)(Ee,{id:a})},"camera".concat(c))}))}function Ee(e){var t=e.id,n=Object(u.i)(z(t));return Object(r.jsx)("div",{className:"outline-text",style:{position:"absolute",left:0,bottom:0,paddingLeft:8,paddingRight:8,color:"#eee",userSelect:"none",width:"100%",overflow:"hidden"},children:n.map((function(e){return Math.round(100*(e+Number.EPSILON))/100})).join(",")})}function Le(e,t,n,r,c){console.log("load image");var i=new Image;i.onload=function(){e.pixel=m(e,1,5);var t=i.width*e.pixel,a=i.height*e.pixel,o=[-t/2,a/2,t/2,-a/2];console.log("image loaded"),n(i);var s=me.apply(void 0,[e,i].concat(o));e.image_draws.push(s),console.log(r),void 0!==r&&r(),void 0!==c&&(console.log(c),c())},i.src=t}function Ce(e,t,n,r){t.addEventListener("change",(function c(i){var a,o=Object(l.a)(this.files);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(!(s.type.indexOf("image")<0)){var j=URL.createObjectURL(s);Le(e,j,n,r),t.value=null}}}catch(u){o.e(u)}finally{o.f()}t.removeEventListener("change",c)})),t.dispatchEvent(new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}))}function Me(e){var t=e.scene_ref,n=Object(u.i)(w),i=Object(u.i)(D),a=Object(u.i)(_),o=Object(u.i)(E),l=Object(u.i)(U),b=(Object(u.i)(R),Object(u.j)(S)),O=Object(u.g)(I),m=Object(j.a)(O,2),x=m[0],k=m[1],g=Object(u.j)(G),y=Object(u.j)(W),L=Object(u.g)(M),C=Object(j.a)(L,2),z=C[0],N=C[1],P=Object(c.useRef)(null),A=Object(c.useRef)(null),T=Object(c.useState)(!1),B=Object(j.a)(T,2),F=B[0],H=B[1],Y=Object(ce.c)(),q=(Y.getIsTrackingHistory,Y.setIsTrackingHistory);return Object(c.useEffect)((function(){if(null!==n[0]&&!F){var e=oe()(P.current);A.current=e;var r=t.current;r.regl=e;for(var c=[],i=0;i<a*o;i++){var l=ke();c.push(l),r.views.push([]),r.view_projections.push([]),r.inverse_view_projections.push([]),r.image_map.push(null)}N(c),r.cameras=Object(s.a)(Array(a*o)).map((function(e){return[0,0,5]})),k(Object(s.a)(Array(a*o)).map((function(e){return null}))),Le(r,"/images/keyboard.png",b,g.bind(null,{active:[0,0,a,o]}),(function(){y({scene:r,active:[0,0,a,o]}),q(!0)}));var u=P.current.getContext("webgl");u.enable(u.SCISSOR_TEST),e.frame((function(t){t.tick;if(e.clear({color:[0,0,0,1]}),r.viewports.length>0)for(var n=r.gridSize[1]-r.viewports[0][3]*r.rows,c=0;c<r.viewports.length;c++){var i=r.viewports[c],a=Object(j.a)(i,4),o=a[0],s=a[1],l=a[2],b=a[3];if(s+=n,u.viewport(o,s,l,b),u.scissor(o,s,l,b),e.clear({color:[0,0,0,1]}),r.image_map.length>0&&null!==r.image_map[c])(0,r.image_draws[r.image_map[c]])({view_projection:r.view_projections[c]})}})),H(!0)}}),[n,F]),Object(c.useEffect)((function(){F&&(t.current.image_map=x)}),[F,x]),Object(c.useEffect)((function(){if(F){for(var e=t.current,r=l.slice(),c=[],s=0;s<o;s++)for(var j=0;j<a;j++){var u=s*a+j,b=(o-1-Math.floor(u/a))*a+u%a;c.push(r[b])}e.cameras=c,e.gridSize=n,e.cols=a,e.rows=o,e.viewports=i,p(e),e.views=[],e.view_projections=[],e.inverse_view_projections=[];for(var O=0;O<a*o;O++)e.views.push([]),e.view_projections.push([]),e.inverse_view_projections.push([]);!function(e){for(var t=0;t<e.cameras.length;t++){var n=e.cameras[t];d(e.views[t],n,h(n),[0,1,0]),v(e.view_projections[t],e.projection,e.views[t]),f(e.inverse_view_projections[t],e.view_projections[t])}}(e)}}),[F,a,o,n,i,z]),null!==n[0]?Object(r.jsxs)("canvas",{width:n[0],height:n[1],ref:P,children:[z.map((function(e,n){return Object(r.jsx)(ze,{id:e,index:n,scene_ref:t},e)})),Object(r.jsx)(se,{canvas_ref:P,scene_ref:t})]}):null}function ze(e){var t=e.id,n=e.index,r=e.scene_ref,i=Object(u.i)(z(t));return Object(c.useEffect)((function(){var e=r.current,t=(e.rows-1-Math.floor(n/e.cols))*e.cols+n%e.cols;e.cameras[t]=i,function(e,t){var n=e.cameras[t];e.views[t]&&(d(e.views[t],n,h(n),[0,1,0]),v(e.view_projections[t],e.projection,e.views[t]),f(e.inverse_view_projections[t],e.view_projections[t]))}(e,t)}),[t,n,i,r]),null}function Ie(){var e=Object(u.i)(k),t=Object(j.a)(e,4),n=t[0],c=t[1],i=t[2],a=t[3];Object(u.i)(_);return Object(r.jsxs)("div",{style:{paddingTop:8,paddingLeft:8},children:["\u25a1 ",n,",",c," ",i,"x",a]})}var Re=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,24)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,i=t.getLCP,a=t.getTTFB;n(e),r(e),c(e),i(e),a(e)}))};o.a.render(Object(r.jsx)(i.a.StrictMode,{children:Object(r.jsx)(ge,{})}),document.getElementById("root")),Re()}},[[23,1,2]]]);
//# sourceMappingURL=main.71fec33d.chunk.js.map