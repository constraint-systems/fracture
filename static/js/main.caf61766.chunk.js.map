{"version":3,"sources":["items/Buttons.js","u/mat4.js","u/gl_utils.js","u/Constants.js","u/shaders.js","u/gl_actions.js","components/Sidebar.js","components/Gridlines.js","handlers/Mouse.js","components/Active.js","components/Gl.js","handlers/Keyboard.js","u/useWindowSize.js","App.js","reportWebVitals.js","index.js"],"names":["KeyButton","props","$button_ref","useRef","text","click","keyname","useEffect","time","interval","$button","current","runInterval","setInterval","pointerDown","e","setPointerCapture","pointerId","setTimeout","pointerUp","releasePointerCapture","clearTimeout","clearInterval","addEventListener","removeEventListener","ref","className","role","KeyButtonOnce","onClick","ToggleKeyButton","compare","multiply","out","a","b","a00","a01","a02","a03","a10","a11","a12","a13","a20","a21","a22","a23","a30","a31","a32","a33","b0","b1","b2","b3","lookAt","eye","center","up","x0","x1","x2","y0","y1","y2","z0","z1","z2","len","eyex","eyey","eyez","upx","upy","upz","centerx","centery","centerz","Math","abs","identity","sqrt","invert","b00","b01","b02","b03","b04","b05","b06","b07","b08","b09","b10","b11","det","multiplyPoint","matrix","point","c0r0","c1r0","c2r0","c3r0","c0r1","c1r1","c2r1","c3r1","c0r2","c1r2","c2r2","c3r2","c0r3","c1r3","c2r3","c3r3","x","y","z","w","setViewports","scene","$render","cols","rows","floor","width","h","height","viewports","r","c","push","setProjectionMatrices","fovy","aspect","near","far","f","tan","nf","perspective","projection","PI","inverse_projection","getLookAt","camera","setViewMatrices","i","cameras","length","views","view_projections","inverse_view_projections","getWorldFromPx","px","camera_dist","world_z","projected","getProjectionZ","raw","point_world","mosaic","indexes","vx","vy","vw","vh","midy","difx","dify","panSetPixels","all_active","index","ndx","ndy","castRay","mouse","viewport","ndz","getNormalizedZ","clips","mouse_position","getClipsFromMouse","device_coordinates","zoomLimit","new_zoom","min","max","zoomCenter","sign","zoom","zoom_mode","active","shake","random","viewportCenter","generateQuadPositions","initImageQuad","$img","regl","frag","vert","attributes","position","uv","uniforms","texture","color","view_projection","prop","count","loadImage","src","Image","onload","pixel","place","image_index","images","drawImage","imageDraws","viewport_image_map","domLoadImage","input","handleChange","this","files","item","name","type","indexOf","URL","createObjectURL","value","dispatchEvent","MouseEvent","bubbles","cancelable","view","window","Heading","style","marginBottom","children","toUpperCase","Info","Spacer","HSpacer","Sidebar","addCol","addRow","remCol","remRow","select_row","select_col","select_all","toggleSelectAll","toggleSelectCol","toggleSelectRow","clearSelections","setZoomMode","setKeyboardActive","file_input","id","bind","display","alignItems","marginRight","Gridlines","Array","map","_","pointerEvents","left","top","background","Mouse","setActive","mouse_ref","down","getActiveFromMouse","mouse_raw","mx","my","mouseMove","clientX","clientY","dx","dy","panViewports","mactive","undefined","mouseDown","mouseWheel","preventDefault","deltaY","passive","Active","ax","ay","show_col","show_row","show_all","every","zoom_coords","border","zoom_pointer_width","Gl","$render_ref","useState","loaded","setLoaded","scene_ref","createREGL","initImageMap","initCameras","all_indexes","gl","getContext","enable","SCISSOR_TEST","frame","tick","clear","vy_offset","scissor","depth","draw","destroy","col","row","inverted_row","Keyboard","km_ref","act","condition","action","downHandler","km","key","toLowerCase","actOnce","keyAction","upHandler","useWindowSize","windowSize","setWindowSize","handleResize","innerWidth","innerHeight","App","size","React","show_sidebar","setCols","setRows","setSelectRow","setSelectCol","setSelectAll","prev","cur_col","cur_row","new_col","Fragment","accept","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.caf61766.chunk.js","sourcesContent":["import React, { useEffect, useRef } from 'react'\n\nexport function KeyButton(props) {\n  let $button_ref = useRef(null)\n  let { text, click, keyname } = props\n\n  useEffect(() => {\n    let $button = $button_ref.current\n    let time\n    let interval\n    function runInterval() {\n      interval = setInterval(click, 60)\n    }\n    function pointerDown(e) {\n      $button.setPointerCapture(e.pointerId)\n      time = setTimeout(runInterval, 250)\n      click()\n    }\n    function pointerUp(e) {\n      $button.releasePointerCapture(e.pointerId)\n      clearTimeout(time)\n      clearInterval(interval)\n    }\n    $button.addEventListener('pointerdown', pointerDown)\n    $button.addEventListener('pointerup', pointerUp)\n    return () => {\n      $button.removeEventListener('pointerdown', pointerDown)\n      $button.removeEventListener('pointerup', pointerUp)\n    }\n  }, [])\n\n  return (\n    <div ref={$button_ref} className=\"button\" role=\"button\">\n      {text !== '' ? text + ' ' : ''}\n      <span className=\"keyname\">{keyname}</span>\n    </div>\n  )\n}\n\nexport function KeyButtonOnce(props) {\n  let $button_ref = useRef(null)\n  let { text, click, keyname } = props\n\n  return (\n    <div ref={$button_ref} className=\"button\" role=\"button\" onClick={click}>\n      {text !== '' ? text + ' ' : ''}\n      <span className=\"keyname\">{keyname}</span>\n    </div>\n  )\n}\n\nexport function ToggleKeyButton(props) {\n  let $button_ref = useRef(null)\n  let { text, click, keyname, compare } = props\n\n  // toggle requires click every time TODO: switch to mousedown for consistent response?\n\n  return (\n    <div\n      ref={$button_ref}\n      className={`button toggle ${compare ? 'active' : ''}`}\n      role=\"button\"\n      onClick={click}\n    >\n      {text !== '' ? text + ' ' : ''}\n      <span className=\"keyname\">{keyname}</span>\n    </div>\n  )\n}\n","/**\n * Set a mat4 to the identity matrix\n *\n * @param {mat4} out the receiving matrix\n * @returns {mat4} out\n */\nexport function identity(out) {\n  out[0] = 1\n  out[1] = 0\n  out[2] = 0\n  out[3] = 0\n  out[4] = 0\n  out[5] = 1\n  out[6] = 0\n  out[7] = 0\n  out[8] = 0\n  out[9] = 0\n  out[10] = 1\n  out[11] = 0\n  out[12] = 0\n  out[13] = 0\n  out[14] = 0\n  out[15] = 1\n  return out\n}\n\n/**\n * Multiplies two mat4's\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the first operand\n * @param {mat4} b the second operand\n * @returns {mat4} out\n */\nexport function multiply(out, a, b) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3],\n    a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7],\n    a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11],\n    a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15]\n\n  // Cache only the current line of the second matrix\n  var b0 = b[0],\n    b1 = b[1],\n    b2 = b[2],\n    b3 = b[3]\n  out[0] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30\n  out[1] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31\n  out[2] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32\n  out[3] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33\n\n  b0 = b[4]\n  b1 = b[5]\n  b2 = b[6]\n  b3 = b[7]\n  out[4] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30\n  out[5] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31\n  out[6] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32\n  out[7] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33\n\n  b0 = b[8]\n  b1 = b[9]\n  b2 = b[10]\n  b3 = b[11]\n  out[8] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30\n  out[9] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31\n  out[10] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32\n  out[11] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33\n\n  b0 = b[12]\n  b1 = b[13]\n  b2 = b[14]\n  b3 = b[15]\n  out[12] = b0 * a00 + b1 * a10 + b2 * a20 + b3 * a30\n  out[13] = b0 * a01 + b1 * a11 + b2 * a21 + b3 * a31\n  out[14] = b0 * a02 + b1 * a12 + b2 * a22 + b3 * a32\n  out[15] = b0 * a03 + b1 * a13 + b2 * a23 + b3 * a33\n  return out\n}\n\n/**\n * Generates a look-at matrix with the given eye position, focal point, and up axis\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {vec3} eye Position of the viewer\n * @param {vec3} center Point the viewer is looking at\n * @param {vec3} up vec3 pointing up\n * @returns {mat4} out\n */\nexport function lookAt(out, eye, center, up) {\n  var x0,\n    x1,\n    x2,\n    y0,\n    y1,\n    y2,\n    z0,\n    z1,\n    z2,\n    len,\n    eyex = eye[0],\n    eyey = eye[1],\n    eyez = eye[2],\n    upx = up[0],\n    upy = up[1],\n    upz = up[2],\n    centerx = center[0],\n    centery = center[1],\n    centerz = center[2]\n\n  if (\n    Math.abs(eyex - centerx) < 0.000001 &&\n    Math.abs(eyey - centery) < 0.000001 &&\n    Math.abs(eyez - centerz) < 0.000001\n  ) {\n    return identity(out)\n  }\n\n  z0 = eyex - centerx\n  z1 = eyey - centery\n  z2 = eyez - centerz\n\n  len = 1 / Math.sqrt(z0 * z0 + z1 * z1 + z2 * z2)\n  z0 *= len\n  z1 *= len\n  z2 *= len\n\n  x0 = upy * z2 - upz * z1\n  x1 = upz * z0 - upx * z2\n  x2 = upx * z1 - upy * z0\n  len = Math.sqrt(x0 * x0 + x1 * x1 + x2 * x2)\n  if (!len) {\n    x0 = 0\n    x1 = 0\n    x2 = 0\n  } else {\n    len = 1 / len\n    x0 *= len\n    x1 *= len\n    x2 *= len\n  }\n\n  y0 = z1 * x2 - z2 * x1\n  y1 = z2 * x0 - z0 * x2\n  y2 = z0 * x1 - z1 * x0\n\n  len = Math.sqrt(y0 * y0 + y1 * y1 + y2 * y2)\n  if (!len) {\n    y0 = 0\n    y1 = 0\n    y2 = 0\n  } else {\n    len = 1 / len\n    y0 *= len\n    y1 *= len\n    y2 *= len\n  }\n\n  out[0] = x0\n  out[1] = y0\n  out[2] = z0\n  out[3] = 0\n  out[4] = x1\n  out[5] = y1\n  out[6] = z1\n  out[7] = 0\n  out[8] = x2\n  out[9] = y2\n  out[10] = z2\n  out[11] = 0\n  out[12] = -(x0 * eyex + x1 * eyey + x2 * eyez)\n  out[13] = -(y0 * eyex + y1 * eyey + y2 * eyez)\n  out[14] = -(z0 * eyex + z1 * eyey + z2 * eyez)\n  out[15] = 1\n\n  return out\n}\n\n/**\n * Generates a perspective projection matrix with the given bounds\n *\n * @param {mat4} out mat4 frustum matrix will be written into\n * @param {number} fovy Vertical field of view in radians\n * @param {number} aspect Aspect ratio. typically viewport width/height\n * @param {number} near Near bound of the frustum\n * @param {number} far Far bound of the frustum\n * @returns {mat4} out\n */\nexport function perspective(out, fovy, aspect, near, far) {\n  var f = 1.0 / Math.tan(fovy / 2),\n    nf = 1 / (near - far)\n  out[0] = f / aspect\n  out[1] = 0\n  out[2] = 0\n  out[3] = 0\n  out[4] = 0\n  out[5] = f\n  out[6] = 0\n  out[7] = 0\n  out[8] = 0\n  out[9] = 0\n  out[10] = (far + near) * nf\n  out[11] = -1\n  out[12] = 0\n  out[13] = 0\n  out[14] = 2 * far * near * nf\n  out[15] = 0\n  return out\n}\n\n/**\n * Inverts a mat4\n *\n * @param {mat4} out the receiving matrix\n * @param {mat4} a the source matrix\n * @returns {mat4} out\n */\nexport function invert(out, a) {\n  var a00 = a[0],\n    a01 = a[1],\n    a02 = a[2],\n    a03 = a[3],\n    a10 = a[4],\n    a11 = a[5],\n    a12 = a[6],\n    a13 = a[7],\n    a20 = a[8],\n    a21 = a[9],\n    a22 = a[10],\n    a23 = a[11],\n    a30 = a[12],\n    a31 = a[13],\n    a32 = a[14],\n    a33 = a[15],\n    b00 = a00 * a11 - a01 * a10,\n    b01 = a00 * a12 - a02 * a10,\n    b02 = a00 * a13 - a03 * a10,\n    b03 = a01 * a12 - a02 * a11,\n    b04 = a01 * a13 - a03 * a11,\n    b05 = a02 * a13 - a03 * a12,\n    b06 = a20 * a31 - a21 * a30,\n    b07 = a20 * a32 - a22 * a30,\n    b08 = a20 * a33 - a23 * a30,\n    b09 = a21 * a32 - a22 * a31,\n    b10 = a21 * a33 - a23 * a31,\n    b11 = a22 * a33 - a23 * a32,\n    // Calculate the determinant\n    det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06\n\n  if (!det) {\n    return null\n  }\n  det = 1.0 / det\n\n  out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det\n  out[1] = (a02 * b10 - a01 * b11 - a03 * b09) * det\n  out[2] = (a31 * b05 - a32 * b04 + a33 * b03) * det\n  out[3] = (a22 * b04 - a21 * b05 - a23 * b03) * det\n  out[4] = (a12 * b08 - a10 * b11 - a13 * b07) * det\n  out[5] = (a00 * b11 - a02 * b08 + a03 * b07) * det\n  out[6] = (a32 * b02 - a30 * b05 - a33 * b01) * det\n  out[7] = (a20 * b05 - a22 * b02 + a23 * b01) * det\n  out[8] = (a10 * b10 - a11 * b08 + a13 * b06) * det\n  out[9] = (a01 * b08 - a00 * b10 - a03 * b06) * det\n  out[10] = (a30 * b04 - a31 * b02 + a33 * b00) * det\n  out[11] = (a21 * b02 - a20 * b04 - a23 * b00) * det\n  out[12] = (a11 * b07 - a10 * b09 - a12 * b06) * det\n  out[13] = (a00 * b09 - a01 * b07 + a02 * b06) * det\n  out[14] = (a31 * b01 - a30 * b03 - a32 * b00) * det\n  out[15] = (a20 * b03 - a21 * b01 + a22 * b00) * det\n\n  return out\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Matrix_math_for_the_web\n// point • matrix\nexport function multiplyPoint(matrix, point) {\n  // Give a simple variable name to each part of the matrix, a column and row number\n  let c0r0 = matrix[0],\n    c1r0 = matrix[1],\n    c2r0 = matrix[2],\n    c3r0 = matrix[3]\n  let c0r1 = matrix[4],\n    c1r1 = matrix[5],\n    c2r1 = matrix[6],\n    c3r1 = matrix[7]\n  let c0r2 = matrix[8],\n    c1r2 = matrix[9],\n    c2r2 = matrix[10],\n    c3r2 = matrix[11]\n  let c0r3 = matrix[12],\n    c1r3 = matrix[13],\n    c2r3 = matrix[14],\n    c3r3 = matrix[15]\n\n  // Now set some simple names for the point\n  let x = point[0]\n  let y = point[1]\n  let z = point[2]\n  let w = point[3]\n\n  // Multiply the point against each part of the 1st column, then add together\n  let resultX = x * c0r0 + y * c0r1 + z * c0r2 + w * c0r3\n\n  // Multiply the point against each part of the 2nd column, then add together\n  let resultY = x * c1r0 + y * c1r1 + z * c1r2 + w * c1r3\n\n  // Multiply the point against each part of the 3rd column, then add together\n  let resultZ = x * c2r0 + y * c2r1 + z * c2r2 + w * c2r3\n\n  // Multiply the point against each part of the 4th column, then add together\n  let resultW = x * c3r0 + y * c3r1 + z * c3r2 + w * c3r3\n\n  return [resultX, resultY, resultZ, resultW]\n}\n\nexport function normalize(vec) {\n  let [x, y, z] = vec\n  let len = Math.sqrt(x * x + y * y + z * z)\n  return [x / len, y / len, z / len]\n}\n\n/**\n * Takes a 4-by-4 matrix and a vector with 3 entries,\n * interprets the vector as a point, transforms that point by the matrix, and\n * returns the result as a vector with 3 entries.\n * @param {module:twgl/m4.Mat4} m The matrix.\n * @param {module:twgl/v3.Vec3} v The point.\n * @param {module:twgl/v3.Vec3} [dst] optional vec3 to store result. If not passed a new one is created.\n * @return {module:twgl/v3.Vec3} The transformed point.\n * @memberOf module:twgl/m4\n */\nexport function transformPoint(m, v, dst) {\n  var v0 = v[0]\n  var v1 = v[1]\n  var v2 = v[2]\n  var d =\n    v0 * m[0 * 4 + 3] + v1 * m[1 * 4 + 3] + v2 * m[2 * 4 + 3] + m[3 * 4 + 3]\n  dst[0] =\n    (v0 * m[0 * 4 + 0] + v1 * m[1 * 4 + 0] + v2 * m[2 * 4 + 0] + m[3 * 4 + 0]) /\n    d\n  dst[1] =\n    (v0 * m[0 * 4 + 1] + v1 * m[1 * 4 + 1] + v2 * m[2 * 4 + 1] + m[3 * 4 + 1]) /\n    d\n  dst[2] =\n    (v0 * m[0 * 4 + 2] + v1 * m[1 * 4 + 2] + v2 * m[2 * 4 + 2] + m[3 * 4 + 2]) /\n    d\n  return dst\n}\n","import { start_zoom, zoom_scaler } from './Constants.js'\nimport {\n  perspective,\n  lookAt,\n  multiply,\n  invert,\n  multiplyPoint,\n  transformPoint,\n  normalize,\n} from './mat4.js'\n\nexport function setViewports(scene, $render, cols, rows) {\n  let w = Math.floor($render.width / cols)\n  let h = Math.floor($render.height / rows)\n  scene.viewports = []\n  for (let r = 0; r < rows; r++) {\n    for (let c = 0; c < cols; c++) {\n      scene.viewports.push([c * w, r * h, w, h])\n    }\n  }\n}\n\nexport function initImageMap(scene, cols, rows) {\n  scene.viewport_image_map = []\n  for (let r = 0; r < rows; r++) {\n    for (let c = 0; c < cols; c++) {\n      scene.viewport_image_map.push(null)\n    }\n  }\n}\n\nexport function initCameras(scene) {\n  scene.cameras = []\n  scene.projection = []\n  scene.inverse_projection = []\n  scene.views = []\n  scene.view_projections = []\n  scene.inverse_view_projections = []\n  for (let i = 0; i < scene.viewports.length; i++) {\n    scene.cameras.push([0, 0, start_zoom])\n    scene.views.push([])\n    scene.view_projections.push([])\n    scene.inverse_view_projections.push([])\n  }\n}\n\nexport function setProjectionMatrices(scene) {\n  let w = scene.viewports[0][2]\n  let h = scene.viewports[0][3]\n  perspective(scene.projection, Math.PI / 3, w / h, 0.01, 100)\n  invert(scene.inverse_projection, scene.projection)\n}\n\nfunction getLookAt(camera) {\n  return [camera[0], camera[1], 0]\n}\n\nexport function setViewMatrices(scene) {\n  for (let i = 0; i < scene.cameras.length; i++) {\n    let camera = scene.cameras[i]\n    lookAt(scene.views[i], camera, getLookAt(camera), [0, 1, 0])\n    multiply(scene.view_projections[i], scene.projection, scene.views[i])\n    invert(scene.inverse_view_projections[i], scene.view_projections[i])\n  }\n}\n\nexport function getProjectionZ(scene, world_z) {\n  let projected = multiplyPoint(scene.projection, [0, 0, world_z, 1])\n  let ndz = projected[2] / projected[3]\n  return ndz\n}\n\nexport function getWorldFromPx(scene, px, camera_dist) {\n  let z = getProjectionZ(scene, -camera_dist)\n  let raw = [(2 * px) / scene.viewports[0][2], 0, z, 1]\n  let point_world = multiplyPoint(scene.inverse_projection, raw)\n  return point_world[0] / point_world[3]\n}\n\nexport function mosaic(scene, indexes) {\n  let $render = scene.$render\n  // need matrices to be initialized already\n  for (let i of indexes) {\n    let [vx, vy, vw, vh] = scene.viewports[i]\n    let camera = scene.cameras[i]\n    let midx = vx + vw / 2\n    let midy = vy + vh / 2\n    let difx = midx - $render.width / 2\n    let dify = midy - $render.height / 2\n    let w = getWorldFromPx(scene, difx, camera[2])\n    let h = getWorldFromPx(scene, dify, camera[2])\n    scene.cameras[i][0] = w\n    scene.cameras[i][1] = h\n  }\n}\n\nexport function panSetPixels(scene, x, y) {\n  let indexes = scene.all_active\n  for (let index of indexes) {\n    let viewport = scene.viewports[index]\n    let camera = scene.cameras[index]\n    let ndx = getWorldFromPx(scene, x * 8, camera[2])\n    let ndy = getWorldFromPx(scene, y * 8, camera[2])\n    scene.cameras[index][0] += ndx\n    scene.cameras[index][1] += ndy\n  }\n}\n\nexport function panViewports(scene, dx, dy) {\n  let indexes = scene.all_active\n  for (let index of indexes) {\n    let viewport = scene.viewports[index]\n    let camera = scene.cameras[index]\n    let ndx = getWorldFromPx(scene, dx, camera[2])\n    let ndy = getWorldFromPx(scene, dy, camera[2])\n    scene.cameras[index][0] -= ndx\n    scene.cameras[index][1] += ndy\n  }\n}\n\nexport function getClipsFromMouse(viewport, mouse_position) {\n  let ratio_x = (mouse_position[0] - viewport[0]) / viewport[2]\n  let ratio_y = (mouse_position[1] - viewport[1]) / viewport[3]\n  let clip_x = 2 * ratio_x - 1\n  let clip_y = 2 * ratio_y - 1\n  return [clip_x, clip_y]\n}\n\nexport function castRay(scene, index, mouse, world_z) {\n  let viewport = scene.viewports[index]\n  let ndz = getNormalizedZ(scene, index, world_z)\n  let clips = getClipsFromMouse(viewport, mouse)\n  let device_coordinates = [clips[0], clips[1], ndz, 1]\n  let point_world = multiplyPoint(\n    scene.inverse_view_projections[index],\n    device_coordinates\n  )\n  // divide by w at end\n  let world_points = [\n    point_world[0] / point_world[3],\n    point_world[1] / point_world[3],\n  ]\n  return world_points\n}\n\nfunction zoomLimit(new_zoom) {\n  let max = 100\n  let min = 0.01\n  return Math.min(max, Math.max(min, new_zoom))\n}\n\nexport function zoomCenter(scene, sign) {\n  let indexes = scene.all_active\n  for (let i of indexes) {\n    let zoom = scene.cameras[i][2]\n    let new_cam\n    if (sign === 1) {\n      new_cam = scene.cameras[i][2] * zoom_scaler\n    } else {\n      new_cam = scene.cameras[i][2] / zoom_scaler\n    }\n    let new_zoom = zoomLimit(new_cam)\n    if (new_zoom > zoom || new_zoom < zoom) {\n      if (scene.zoom_mode === 'canvas') {\n        let projected = castRay(\n          scene,\n          i,\n          [scene.width / 2, scene.height / 2],\n          new_zoom\n        )\n        scene.cameras[i] = [...projected, new_zoom]\n      } else if (scene.zoom_mode === 'active') {\n        // TODO figure out if this is what you sant\n        let viewport = scene.viewports[scene.active]\n        let projected = castRay(\n          scene,\n          i,\n          [viewport[0] + viewport[2] / 2, viewport[1] + viewport[3] / 2],\n          new_zoom\n        )\n        scene.cameras[i] = [...projected, new_zoom]\n      } else if (scene.zoom_mode === 'every') {\n        scene.cameras[i][2] = new_zoom\n      }\n    }\n  }\n}\n\nexport function getNormalizedZ(scene, index, world_z) {\n  let projected = multiplyPoint(scene.view_projections[index], [\n    0,\n    0,\n    world_z,\n    1,\n  ])\n  let ndz = projected[2] / projected[3]\n  return ndz\n}\n\nexport function shake(scene) {\n  let indexes = scene.all_active\n  for (let index of indexes) {\n    scene.cameras[index][0] += 1 - 2 * Math.random()\n    scene.cameras[index][1] += 1 - 2 * Math.random()\n  }\n}\n\nexport function viewportCenter(scene) {\n  let indexes = scene.all_active\n  for (let index of indexes) {\n    scene.cameras[index][0] = 0\n    scene.cameras[index][1] = 0\n  }\n}\n","export let sidebar_width = 320\nexport let start_zoom = 10\nexport let base_zoom = 5\nexport let zoom_scaler = 1.125\n","export function generateQuadPositions(x0, y0, x1, y1) {\n  return [\n    [x0, y0],\n    [x1, y0],\n    [x0, y1],\n    [x0, y1],\n    [x1, y0],\n    [x1, y1],\n  ]\n}\n\nexport function initImageQuad(scene, $img, x0, y0, x1, y1) {\n  let regl = scene.regl\n  return regl({\n    frag: `\n    precision mediump float;\n    uniform vec4 color;\n    uniform sampler2D texture;\n    varying vec2 vuv;\n    void main () {\n      gl_FragColor = texture2D(texture, vuv);\n    }`,\n    vert: `\n    precision mediump float;\n    attribute vec2 position;\n    attribute vec2 uv;\n    varying vec2 vuv;\n    uniform mat4 view_projection;\n    void main () {\n      vuv = uv;\n      gl_Position = view_projection * vec4(position, 0, 1);\n    }`,\n    attributes: {\n      position: generateQuadPositions(x0, y0, x1, y1),\n      uv: [\n        [0, 0],\n        [1, 0],\n        [0, 1],\n        [0, 1],\n        [1, 0],\n        [1, 1],\n      ],\n    },\n    uniforms: {\n      texture: regl.texture($img),\n      color: [1, 1, 0, 1],\n      view_projection: regl.prop('view_projection'),\n    },\n    count: 6,\n  })\n}\n","import { initImageQuad } from './shaders.js'\n\nexport function loadImage(scene, src, indexes) {\n  let $img = new Image()\n  $img.onload = function () {\n    let w = $img.width * scene.pixel\n    let h = $img.height * scene.pixel\n\n    let x0 = -w / 2\n    let y0 = h / 2\n    let x1 = w / 2\n    let y1 = -h / 2\n    let place = [x0, y0, x1, y1]\n\n    let image_index = scene.images.length\n    scene.images.push($img)\n    let drawImage = initImageQuad(scene, $img, ...place)\n    scene.imageDraws.push(drawImage)\n\n    for (let i = 0; i < indexes.length; i++) {\n      let index = indexes[i]\n      scene.viewport_image_map[index] = image_index\n    }\n  }\n  $img.src = src\n}\n\nexport function domLoadImage(scene, input) {\n  function handleChange(e) {\n    let files = ''\n    for (let item of this.files) {\n      files += item.name + '.' + item.type\n      if (item.type.indexOf('image') < 0) {\n        continue\n      }\n      let src = URL.createObjectURL(item)\n      loadImage(scene, src, scene.all_active)\n      input.value = null\n    }\n    input.removeEventListener('change', handleChange)\n  }\n  input.addEventListener('change', handleChange)\n\n  input.dispatchEvent(\n    new MouseEvent('click', {\n      bubbles: true,\n      cancelable: true,\n      view: window,\n    })\n  )\n}\n\n\n","import React, { useState } from 'react'\nimport { KeyButton, ToggleKeyButton, KeyButtonOnce } from '../items/Buttons.js'\nimport {\n  panSetPixels,\n  zoomCenter,\n  shake,\n  viewportCenter,\n  mosaic,\n} from '../u/gl_utils.js'\nimport { domLoadImage } from '../u/gl_actions.js'\n\nfunction Heading(props) {\n  return <div style={{ marginBottom: 8 }}>{props.children.toUpperCase()}</div>\n}\n\nfunction Info(props) {\n  return <div style={{ marginBottom: 8 }}>{props.children}</div>\n}\n\nfunction Spacer() {\n  return <div style={{ width: '100%', height: 8 }}></div>\n}\n\nfunction HSpacer() {\n  return <div style={{ width: '100%', height: 4 }}></div>\n}\n\nfunction Sidebar(props) {\n  let {\n    scene,\n    width,\n    rows,\n    cols,\n    addCol,\n    addRow,\n    remCol,\n    remRow,\n    select_row,\n    select_col,\n    select_all,\n    toggleSelectAll,\n    toggleSelectCol,\n    toggleSelectRow,\n    clearSelections,\n    zoom_mode,\n    setZoomMode,\n    setKeyboardActive,\n    file_input,\n  } = props\n  return (\n    <div id=\"sidebar\" style={{ width }}>\n      <Heading>Selections</Heading>\n      <div>\n        <ToggleKeyButton\n          text=\"Column\"\n          keyname=\"q\"\n          compare={select_col}\n          click={toggleSelectCol}\n        />\n        <ToggleKeyButton\n          text=\"Row\"\n          keyname=\"w\"\n          compare={select_row}\n          click={toggleSelectRow}\n        />\n        <ToggleKeyButton\n          text=\"All\"\n          keyname=\"e\"\n          compare={select_all}\n          click={toggleSelectAll}\n        />\n        <KeyButton text=\"Clear\" keyname=\"escape\" click={clearSelections} />\n      </div>\n      <Spacer />\n      <HSpacer />\n      <Heading>Pan</Heading>\n      <Info>Click and drag or use</Info>\n      <div>\n        <KeyButton\n          text=\"\"\n          keyname=\"←\"\n          click={panSetPixels.bind(null, scene, 1, 0)}\n        />\n        <KeyButton\n          text=\"\"\n          keyname=\"↓\"\n          click={panSetPixels.bind(null, scene, 0, 1)}\n        />\n        <KeyButton\n          text=\"\"\n          keyname=\"↑\"\n          click={panSetPixels.bind(null, scene, 0, -1)}\n        />\n        <KeyButton\n          text=\"\"\n          keyname=\"→\"\n          click={panSetPixels.bind(null, scene, -1, 0)}\n        />\n      </div>\n      <Spacer />\n      <HSpacer />\n      <Heading>Zoom</Heading>\n      <Info>Use mousewheel or</Info>\n      <div>\n        <KeyButton\n          text=\"Zoom in\"\n          keyname=\"+\"\n          click={zoomCenter.bind(null, scene, 1)}\n        />\n        <KeyButton\n          text=\"Zoom out\"\n          keyname=\"-\"\n          click={zoomCenter.bind(null, scene, -1)}\n        />\n      </div>\n      <Spacer />\n      <HSpacer />\n      <Heading>Zoom center</Heading>\n      <div>\n        <ToggleKeyButton\n          text=\"Canvas\"\n          keyname=\"z\"\n          compare={zoom_mode === 'canvas'}\n          click={setZoomMode.bind(null, 'canvas')}\n        />\n        <ToggleKeyButton\n          text=\"Active\"\n          keyname=\"x\"\n          compare={zoom_mode === 'active'}\n          click={setZoomMode.bind(null, 'active')}\n        />\n        <ToggleKeyButton\n          text=\"Every\"\n          keyname=\"c\"\n          compare={zoom_mode === 'every'}\n          click={setZoomMode.bind(null, 'every')}\n        />\n      </div>\n      <Spacer />\n      <HSpacer />\n      <Heading>Set Active</Heading>\n      <Info>Move mouse, tap, or use</Info>\n      <KeyButton\n        text=\"←\"\n        keyname=\"h\"\n        click={setKeyboardActive.bind(null, -1, 0)}\n      />\n      <KeyButton\n        text=\"↓\"\n        keyname=\"j\"\n        click={setKeyboardActive.bind(null, 0, 1)}\n      />\n      <KeyButton\n        text=\"↑\"\n        keyname=\"k\"\n        click={setKeyboardActive.bind(null, 0, -1)}\n      />\n      <KeyButton\n        text=\"→\"\n        keyname=\"l\"\n        click={setKeyboardActive.bind(null, 1, 0)}\n      />\n      <Spacer />\n      <HSpacer />\n      <Heading>Load image to selection</Heading>\n      <KeyButtonOnce\n        text=\"Load image\"\n        keyname=\"o\"\n        click={domLoadImage.bind(null, scene, file_input)}\n      />\n      <Spacer />\n      <HSpacer />\n      <Heading>More actions</Heading>\n      <KeyButton text=\"Shake\" keyname=\"t\" click={shake.bind(null, scene)} />\n      <KeyButton\n        text=\"Center\"\n        keyname=\"y\"\n        click={viewportCenter.bind(null, scene)}\n      />\n      <KeyButton\n        text=\"Relative Center\"\n        keyname=\"u\"\n        click={mosaic.bind(null, scene, scene.all_active)}\n      />\n      <Spacer />\n      <HSpacer />\n      <Heading>Size</Heading>\n      <div\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n        }}\n      >\n        <div style={{ marginBottom: 8, marginRight: 8 }}>Cols:</div>\n        <div>\n          <KeyButton text=\"-\" keyname=\"f\" click={remCol} />\n          <KeyButton text=\"+\" keyname=\"g\" click={addCol} />\n        </div>\n        <div style={{ marginBottom: 8 }}>{cols}</div>\n      </div>\n      <div\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n        }}\n      >\n        <div style={{ marginBottom: 8, marginRight: 8 }}>Rows:</div>\n        <div>\n          <KeyButton text=\"-\" keyname=\"v\" click={remRow} />\n          <KeyButton text=\"+\" keyname=\"b\" click={addRow} />\n        </div>\n        <div style={{ marginBottom: 8 }}>{rows}</div>\n      </div>\n    </div>\n  )\n}\n\nexport default Sidebar\n","import React, { useState, useEffect, useRef } from 'react'\n\nfunction Gridlines(props) {\n  let { cols, rows, width, height } = props\n  let vw = Math.floor(width / cols)\n  let vh = Math.floor(height / rows)\n  return (\n    <div>\n      {cols > 0\n        ? [...Array(cols - 1)].map((_, c) => {\n            return (\n              <div\n                key={`col_${c}`}\n                style={{\n                  pointerEvents: 'none',\n                  position: 'absolute',\n                  left: (c + 1) * vw - 1,\n                  top: 0,\n                  width: 2,\n                  height: '100%',\n                  background: 'rgba(100,100,100,0.5)',\n                }}\n              ></div>\n            )\n          })\n        : null}\n\n      {rows > 0\n        ? [...Array(rows - 1)].map((_, r) => {\n            return (\n              <div\n                key={`row_${r}`}\n                style={{\n                  pointerEvents: 'none',\n                  position: 'absolute',\n                  left: 0,\n                  top: (r + 1) * vh - 1,\n                  height: 2,\n                  width: '100%',\n                  background: 'rgba(100,100,100,0.5)',\n                }}\n              ></div>\n            )\n          })\n        : null}\n    </div>\n  )\n}\n\nexport default Gridlines\n","import React, { useState, useEffect, useRef } from 'react'\nimport { panViewports, zoomCenter } from '../u/gl_utils.js'\n\nfunction Mouse(props) {\n  let { $render, scene, active, setActive } = props\n  let mouse_ref = useRef({\n    raw: [0, 0],\n    down: false,\n  })\n\n  useEffect(() => {\n    let mouse = mouse_ref.current\n\n    function getActiveFromMouse(mouse_raw) {\n      let [mx, my] = mouse_raw\n      for (let i = 0; i < scene.viewports.length; i++) {\n        let viewport = scene.viewports[i]\n        let [x, y, w, h] = viewport\n        if (mx >= x && mx <= x + w && my >= y && my <= y + h) {\n          return i\n        }\n      }\n    }\n\n    function mouseMove(e) {\n      let raw = [e.clientX, e.clientY]\n      // assume container is at left bottom\n      if (mouse.down) {\n        let dx = raw[0] - mouse.raw[0]\n        let dy = raw[1] - mouse.raw[1]\n        panViewports(scene, dx, dy)\n      } else {\n        let mactive = getActiveFromMouse(mouse.raw)\n        if (mactive !== undefined && mactive !== active) {\n          setActive(mactive)\n        }\n      }\n      mouse.raw = raw\n    }\n\n    function mouseDown(e) {\n      mouse.down = [e.clientX, e.clientY]\n      $render.setPointerCapture(e.pointerId)\n    }\n\n    function mouseUp(e) {\n      mouse.down = null\n      let mactive = getActiveFromMouse(mouse.raw)\n      if (mactive !== undefined && mactive !== active) {\n        setActive(mactive)\n      }\n      $render.releasePointerCapture(e.pointerId)\n    }\n\n    function mouseWheel(e) {\n      e.preventDefault()\n\n      let sign = e.deltaY < 0 ? -1 : 1\n      zoomCenter(scene, sign)\n    }\n\n    $render.addEventListener('mousemove', mouseMove)\n    $render.addEventListener('pointerdown', mouseDown)\n    $render.addEventListener('pointerup', mouseUp)\n    $render.addEventListener('wheel', mouseWheel, { passive: false })\n    return () => {\n      $render.removeEventListener('mousemove', mouseMove)\n      $render.removeEventListener('pointerdown', mouseDown)\n      $render.removeEventListener('pointerup', mouseDown)\n      $render.removeEventListener('wheel', mouseWheel)\n    }\n  }, [])\n\n  return null\n}\n\nexport default Mouse\n","import React, { useState, useEffect, useRef, Fragment } from 'react'\n\nfunction Active(props) {\n  let {\n    active,\n    width,\n    height,\n    rows,\n    cols,\n    select_col,\n    select_row,\n    select_all,\n    zoom_mode,\n  } = props\n  let vw = Math.floor(width / cols)\n  let vh = Math.floor(height / rows)\n  let ax = active % cols\n  let ay = Math.floor(active / rows)\n  let x = ax * vw\n  let y = ay * vh\n\n  let show_col = select_col && !select_all\n  let show_row = select_row && !select_all\n  let show_all = select_all\n\n  let every = zoom_mode === 'every'\n  let zoom_coords = []\n  if (every) {\n  } else {\n    if (zoom_mode === 'canvas') {\n      zoom_coords = [Math.floor(width / 2), Math.floor(height / 2)]\n    } else if (zoom_mode === 'active') {\n      zoom_coords = [x + vw / 2, y + vh / 2]\n    }\n  }\n\n  let zoom_pointer_width = 8\n  let zp = zoom_pointer_width / 2\n\n  return (\n    <Fragment>\n      {show_col ? (\n        <div\n          style={{\n            pointerEvents: 'none',\n            position: 'fixed',\n            left: x - 1,\n            top: 0 - 1,\n            width: vw + 2,\n            height: height + 2,\n            border: 'solid 2px rgba(160, 160, 160, 0.5)',\n          }}\n        ></div>\n      ) : null}\n      {show_row ? (\n        <div\n          style={{\n            pointerEvents: 'none',\n            position: 'fixed',\n            left: 0 - 1,\n            top: y - 1,\n            width: width + 2,\n            height: vh + 2,\n            border: 'solid 2px rgba(160, 160, 160, 0.5)',\n          }}\n        ></div>\n      ) : null}\n      {show_all ? (\n        <div\n          style={{\n            pointerEvents: 'none',\n            position: 'fixed',\n            left: 0 - 1,\n            top: 0 - 1,\n            width: width + 2,\n            height: height + 2,\n            border: 'solid 2px rgba(160, 160, 160, 0.5)',\n          }}\n        ></div>\n      ) : null}\n      <div\n        style={{\n          pointerEvents: 'none',\n          position: 'fixed',\n          left: x - 1,\n          top: y - 1,\n          width: vw + 2,\n          height: vh + 2,\n          border: 'solid 2px rgba(240, 240, 240, 0.5)',\n        }}\n      ></div>\n      {every ? (\n        <div>\n          {show_all ? (\n            [...Array(cols * rows)].map((_, i) => {\n              let c = i % cols\n              let r = Math.floor(i / cols)\n              return (\n                <div\n                  className=\"zoom_pointer\"\n                  key={`every_${i}`}\n                  style={{\n                    left: c * vw + vw / 2 - zp,\n                    top: r * vh + vh / 2 - zp,\n                  }}\n                ></div>\n              )\n            })\n          ) : (\n            <div\n              className=\"zoom_pointer\"\n              style={{\n                left: x + vw / 2 - zp,\n                top: y + vh / 2 - zp,\n              }}\n            ></div>\n          )}\n          {show_col\n            ? [...Array(rows)].map((_, r) => {\n                if (r === ay) {\n                  return null\n                } else {\n                  return (\n                    <div\n                      className=\"zoom_pointer\"\n                      key={`col_${r}`}\n                      style={{\n                        left: x + vw / 2 - zp,\n                        top: r * vh + vh / 2 - zp,\n                      }}\n                    ></div>\n                  )\n                }\n              })\n            : null}\n          {show_row\n            ? [...Array(cols)].map((_, c) => {\n                if (c === ax) {\n                  return null\n                } else {\n                  return (\n                    <div\n                      className=\"zoom_pointer\"\n                      key={`row_${c}`}\n                      style={{\n                        left: c * vw + vw / 2 - zp,\n                        top: y + vh / 2 - zp,\n                      }}\n                    ></div>\n                  )\n                }\n              })\n            : null}\n        </div>\n      ) : (\n        <div\n          className=\"zoom_pointer\"\n          style={{\n            left: zoom_coords[0] - zp,\n\n            top: zoom_coords[1] - zp,\n          }}\n        ></div>\n      )}\n    </Fragment>\n  )\n}\n\nexport default Active\n","import React, { useState, useEffect, useRef, Fragment } from 'react'\nimport Gridlines from './Gridlines.js'\nimport { base_zoom } from '../u/Constants.js'\nimport {\n  setViewports,\n  initCameras,\n  initImageMap,\n  setProjectionMatrices,\n  setViewMatrices,\n  getWorldFromPx,\n  mosaic,\n} from '../u/gl_utils.js'\nimport { loadImage } from '../u/gl_actions.js'\nimport Mouse from '../handlers/Mouse.js'\nimport Active from './Active.js'\n\nfunction Gl(props) {\n  let $render_ref = useRef(null)\n  let [loaded, setLoaded] = useState(false)\n  let {\n    width,\n    height,\n    scene_ref,\n    rows,\n    cols,\n    select_row,\n    select_col,\n    select_all,\n    zoom_mode,\n    active,\n    setActive,\n  } = props\n  let scene = scene_ref.current\n  let $render = $render_ref.current\n\n  useEffect(() => {\n    setLoaded(true)\n\n    let $render = $render_ref.current\n    let regl = window.createREGL($render)\n    scene.regl = regl\n    scene.$render = $render\n\n    scene.images = []\n    scene.imageDraws = []\n    setViewports(scene, $render, cols, rows)\n    initImageMap(scene, cols, rows)\n    initCameras(scene)\n    setProjectionMatrices(scene)\n    setViewMatrices(scene)\n\n    scene.pixel = getWorldFromPx(scene, 1, base_zoom)\n\n    let all_indexes = [...Array(cols * rows)].map((_, i) => i)\n\n    loadImage(scene, '/images/keyboard.png', all_indexes)\n    mosaic(scene, all_indexes)\n\n    let gl = $render.getContext('webgl')\n    gl.enable(gl.SCISSOR_TEST)\n\n    regl.frame(({ tick }) => {\n      regl.clear({\n        color: [0, 0, 0, 1],\n      })\n      setViewMatrices(scene)\n      let vy_offset = height - scene.viewports[0][3] * rows\n      for (let i = 0; i < scene.viewports.length; i++) {\n        let viewport = scene.viewports[i]\n        let [vx, vy, vw, vh] = viewport\n        // gap at bottom instead of top\n        vy = vy + vy_offset\n        gl.viewport(vx, vy, vw, vh)\n        gl.scissor(vx, vy, vw, vh)\n        regl.clear({\n          color: [0.1, 0.1, 0.1, 1],\n          depth: 1,\n        })\n        if (scene.viewport_image_map[i] !== null) {\n          let draw = scene.imageDraws[scene.viewport_image_map[i]]\n          draw({\n            view_projection: scene.view_projections[i],\n          })\n        }\n      }\n    })\n    return regl.destroy\n  }, [])\n\n  useEffect(() => {\n    let $render = $render_ref.current\n    setViewports(scene, $render, cols, rows)\n    setProjectionMatrices(scene)\n    // TODO special case add cols and rows\n    // TODO compensate camera based on relation to center\n  }, [cols, rows, width, height])\n\n  // shadow state with scene\n  let all_indexes = [...Array(cols * rows)].map((_, i) => i)\n  let col = active % cols\n  let row = Math.floor(active / cols)\n  let inverted_row = rows - 1 - row\n  scene.active = inverted_row * cols + col\n  if (select_all) {\n    scene.all_active = all_indexes\n  } else {\n    scene.all_active = [scene.active]\n    if (select_col) {\n      let col = scene.active % cols\n      let col_array = []\n      for (let r = 0; r < rows; r++) {\n        let i = r * cols + col\n        if (i !== scene.active) scene.all_active.push(i)\n      }\n    }\n    if (select_row) {\n      let row = Math.floor(scene.active / cols)\n      for (let c = 0; c < cols; c++) {\n        let i = row * cols + c\n        if (i !== scene.active) scene.all_active.push(i)\n      }\n    }\n  }\n  scene.width = width\n  scene.height = height\n  scene.zoom_mode = zoom_mode\n\n  return (\n    <div\n      style={{\n        position: 'relative',\n        width: width,\n        height: height,\n      }}\n    >\n      <canvas ref={$render_ref} width={width} height={height}></canvas>\n      {loaded ? (\n        <Fragment>\n          <Gridlines rows={rows} cols={cols} width={width} height={height} />\n          <Mouse\n            $render={$render_ref.current}\n            scene={scene}\n            setActive={setActive}\n          />\n          <Active\n            active={active}\n            rows={rows}\n            cols={cols}\n            width={width}\n            scene={scene}\n            height={height}\n            select_col={select_col}\n            select_row={select_row}\n            select_all={select_all}\n            zoom_mode={zoom_mode}\n          />\n        </Fragment>\n      ) : null}\n    </div>\n  )\n}\n\nexport default Gl\n","import React, { useEffect, useState, useRef } from 'react'\nimport {\n  panSetPixels,\n  zoomCenter,\n  shake,\n  viewportCenter,\n  mosaic,\n} from '../u/gl_utils.js'\nimport { domLoadImage } from '../u/gl_actions.js'\n\nfunction Keyboard(props) {\n  let km_ref = useRef({})\n  let scene = props.scene_ref.current\n  let {\n    addCol,\n    addRow,\n    remCol,\n    remRow,\n    toggleSelectCol,\n    toggleSelectRow,\n    toggleSelectAll,\n    clearSelections,\n    setZoomMode,\n    setKeyboardActive,\n    file_input,\n  } = props\n\n  function act(condition, action) {\n    let km = km_ref.current\n    if (km[condition]) {\n      action()\n    }\n  }\n\n  function actOnce(key, condition, action) {\n    if (key === condition) {\n      action()\n    }\n  }\n\n  useEffect(() => {\n    function keyAction(key, e) {\n      // change selections\n      act('q', toggleSelectCol)\n      act('w', toggleSelectRow)\n      act('e', toggleSelectAll)\n      act('escape', clearSelections)\n\n      // pan active\n      act('arrowleft', panSetPixels.bind(null, scene, 1, 0))\n      act('arrowright', panSetPixels.bind(null, scene, -1, 0))\n      act('arrowup', panSetPixels.bind(null, scene, 0, -1))\n      act('arrowdown', panSetPixels.bind(null, scene, 0, 1))\n\n      // zoom\n      act('+', zoomCenter.bind(null, scene, -1))\n      act('=', zoomCenter.bind(null, scene, -1))\n      act('-', zoomCenter.bind(null, scene, 1))\n\n      // zoom mode\n      act('z', setZoomMode.bind(null, 'canvas'))\n      act('x', setZoomMode.bind(null, 'active'))\n      act('c', setZoomMode.bind(null, 'every'))\n\n      // zoom active\n      act('h', setKeyboardActive.bind(null, -1, 0))\n      act('j', setKeyboardActive.bind(null, 0, 1))\n      act('k', setKeyboardActive.bind(null, 0, -1))\n      act('l', setKeyboardActive.bind(null, 1, 0))\n\n      // load image\n      actOnce(key, 'o', domLoadImage.bind(null, scene, file_input))\n\n      // more actions\n      act('t', shake.bind(null, scene))\n      act('y', viewportCenter.bind(null, scene))\n      act('u', mosaic.bind(null, scene, scene.all_active))\n\n      // add/rem rows and cols\n      act('g', addCol)\n      act('f', remCol)\n      act('b', addRow)\n      act('v', remRow)\n    }\n\n    function downHandler(e) {\n      let km = km_ref.current\n      let key = e.key.toLowerCase()\n      km[key] = true\n      keyAction(key, e)\n    }\n\n    function upHandler(e) {\n      let km = km_ref.current\n      let key = e.key.toLowerCase()\n      km[key] = false\n    }\n\n    window.addEventListener('keydown', downHandler)\n    window.addEventListener('keyup', upHandler)\n    return () => {\n      window.removeEventListener('keydown', downHandler)\n      window.removeEventListener('keyup', upHandler)\n    }\n  }, [])\n  return null\n}\n\nexport default Keyboard\n","import { useState, useEffect } from 'react'\n\n// Hook from https://usehooks.com/useWindowSize/\nfunction useWindowSize() {\n  // Initialize state with undefined width/height so server and client renders match\n  // Learn more here: https://joshwcomeau.com/react/the-perils-of-rehydration/\n  const [windowSize, setWindowSize] = useState({\n    width: undefined,\n    height: undefined,\n  })\n\n  useEffect(() => {\n    // Handler to call on window resize\n    function handleResize() {\n      // Set window width/height to state\n      setWindowSize({\n        width: window.innerWidth,\n        height: window.innerHeight,\n      })\n    }\n\n    // Add event listener\n    window.addEventListener('resize', handleResize)\n\n    // Call handler right away so state gets updated with initial window size\n    handleResize()\n\n    // Remove event listener on cleanup\n    return () => window.removeEventListener('resize', handleResize)\n  }, []) // Empty array ensures that effect is only run on mount\n\n  return windowSize\n}\n\nexport default useWindowSize\n","import React, { useState, useRef } from 'react'\nimport Sidebar from './components/Sidebar.js'\nimport Gl from './components/Gl.js'\nimport { sidebar_width } from './u/Constants.js'\nimport Keyboard from './handlers/Keyboard.js'\nimport useWindowSize from './u/useWindowSize.js'\n\nfunction App() {\n  let size = useWindowSize()\n  let file_input = React.useRef(null)\n  let [show_sidebar, setShowSidebar] = useState(true)\n  let [cols, setCols] = useState(8)\n  let [rows, setRows] = useState(8)\n  let [active, setActive] = useState(0)\n  let [select_row, setSelectRow] = useState(false)\n  let [select_col, setSelectCol] = useState(false)\n  let [select_all, setSelectAll] = useState(false)\n  let [zoom_mode, setZoomMode] = useState('canvas')\n\n  let addCol = () => {\n    setCols((prev) => Math.min(16, prev + 1))\n  }\n  let remCol = () => {\n    setCols((prev) => Math.max(1, prev - 1))\n  }\n  let addRow = () => {\n    setRows((prev) => Math.min(16, prev + 1))\n  }\n  let remRow = () => {\n    setRows((prev) => Math.max(1, prev - 1))\n  }\n  let toggleSelectRow = () => {\n    setSelectRow((prev) => {\n      if (prev === false) {\n        setSelectAll(false)\n      }\n      return !prev\n    })\n  }\n  let toggleSelectCol = () => {\n    setSelectCol((prev) => {\n      if (prev === false) {\n        setSelectAll(false)\n      }\n      return !prev\n    })\n  }\n  let toggleSelectAll = () => {\n    setSelectAll((prev) => {\n      if (prev === false) {\n        setSelectCol(false)\n        setSelectRow(false)\n      }\n      return !prev\n    })\n  }\n  let clearSelections = () => {\n    setSelectCol(false)\n    setSelectRow(false)\n    setSelectAll(false)\n  }\n\n  let scene_ref = React.useRef({\n    active: 0,\n    all_active: [0],\n  })\n\n  let setKeyboardActive = (dx, dy) => {\n    setActive((prev) => {\n      let cur_col = prev % cols\n      let cur_row = Math.floor(prev / cols)\n      let new_col = Math.max(0, Math.min(cols - 1, cur_col + dx))\n      let new_row = Math.max(0, Math.min(rows - 1, cur_row + dy))\n      return new_row * cols + new_col\n    })\n  }\n\n  return (\n    <React.Fragment>\n      <input\n        style={{ display: 'none' }}\n        type=\"file\"\n        accept=\"image/*\"\n        ref={file_input}\n      />\n      {size.width && show_sidebar ? (\n        <Sidebar\n          scene={scene_ref.current}\n          width={sidebar_width}\n          cols={cols}\n          rows={rows}\n          select_row={select_row}\n          select_col={select_col}\n          select_all={select_all}\n          zoom_mode={zoom_mode}\n          addCol={addCol}\n          addRow={addRow}\n          remCol={remCol}\n          remRow={remRow}\n          toggleSelectAll={toggleSelectAll}\n          toggleSelectRow={toggleSelectRow}\n          toggleSelectCol={toggleSelectCol}\n          clearSelections={clearSelections}\n          setKeyboardActive={setKeyboardActive}\n          setZoomMode={setZoomMode}\n          file_input={file_input.current}\n        />\n      ) : null}\n\n      {size.width ? (\n        <Keyboard\n          scene_ref={scene_ref}\n          addCol={addCol}\n          addRow={addRow}\n          remCol={remCol}\n          remRow={remRow}\n          toggleSelectAll={toggleSelectAll}\n          toggleSelectRow={toggleSelectRow}\n          toggleSelectCol={toggleSelectCol}\n          clearSelections={clearSelections}\n          setZoomMode={setZoomMode}\n          setKeyboardActive={setKeyboardActive}\n          file_input={file_input.current}\n        />\n      ) : null}\n      {size.width ? (\n        <Gl\n          width={size.width - sidebar_width}\n          height={size.height}\n          size={size}\n          scene_ref={scene_ref}\n          cols={cols}\n          rows={rows}\n          active={active}\n          select_row={select_row}\n          select_col={select_col}\n          select_all={select_all}\n          zoom_mode={zoom_mode}\n          setZoomMode={setZoomMode}\n          setActive={setActive}\n        />\n      ) : (\n        <div>Loading...</div>\n      )}\n    </React.Fragment>\n  )\n}\n\nexport default App\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './font.css'\nimport './style.css'\nimport App from './App'\nimport reportWebVitals from './reportWebVitals'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals()\n"],"sourceRoot":""}